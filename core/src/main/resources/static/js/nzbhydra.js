angular.module("templates",[]);var nzbhydraapp=angular.module("nzbhydraApp",["angular-loading-bar","cgBusy","ui.bootstrap","ipCookie","angular-growl","angular.filter","filters","ui.router","blockUI","mgcrea.ngStrap","angularUtils.directives.dirPagination","nvd3","formly","formlyBootstrap","frapontillo.bootstrap-switch","ui.select","ngSanitize","checklist-model","ngAria","ngMessages","ui.router.title","LocalStorageModule","angular.filter","ngFileUpload","ngCookies","angular.chips","templates","base64","duScroll"]);function hydraTasks(){return e.$inject=["$scope","$http"],{templateUrl:"static/html/directives/tasks.html",controller:e};function e(e,t){t.get("internalapi/tasks").then(function(t){e.tasks=t.data}),e.runTask=function(n){t.put("internalapi/tasks/"+n).then(function(t){e.tasks=t.data})}}}function tabOrChart(){return{templateUrl:"static/html/directives/tab-or-chart.html",transclude:{chartSlot:"chart",tableSlot:"table"},restrict:"E",replace:!0,scope:{display:"@"}}}function sendTorrentToBlackhole(){return e.$inject=["$scope","$http","growl","ConfigService","DebugService"],{templateUrl:"static/html/directives/send-torrent-to-blackhole.html",scope:{searchResultId:"<"},controller:e};function e(e,t,n,a,r){e.useBlackhole=null!==a.getSafe().downloading.saveTorrentsTo&&""!==a.getSafe().downloading.saveTorrentsTo,e.cssClass="glyphicon-save-file",e.add=function(){e.cssClass="nzb-spinning",t.put("internalapi/saveTorrent",[e.searchResultId]).then(function(t){t.data.successful?e.cssClass="glyphicon-ok":(e.cssClass="glyphicon-remove",n.error(t.data.message))})},r.log("blackhole")}}function selectionButton(){return e.$inject=["$scope"],{templateUrl:"static/html/directives/selection-button.html",scope:{selected:"=",selectable:"=",invertSelection:"<",selectAll:"<",deselectAll:"<",btn:"@"},controller:e};function e(e){angular.isUndefined(e.btn)&&(e.btn="default"),angular.isUndefined(e.invertSelection)&&(e.invertSelection=function(){e.selected=_.difference(e.selectable,e.selected)}),angular.isUndefined(e.selectAll)&&(e.selectAll=function(){e.selected.push.apply(e.selected,e.selectable)}),angular.isUndefined(e.deselectAll)&&(e.deselectAll=function(){e.selected.splice(0,e.selected.length)})}}function searchResult(){return e.$inject=["$scope","$element","$http","growl","$attrs","$uibModal","$window","DebugService","localStorageService","HydraAuthService"],{templateUrl:"static/html/directives/search-result.html",require:"^result",replace:!1,scope:{result:"<"},controller:e};function e(e,t,n,a,r,o,i,l,s,c){var u,d,p,f,h,m;e.foo={},function(e,t){function n(){e.resultDisplayed=(0===e.result.titleGroupIndex||e.titlesExpanded)&&(e.duplicatesExpanded||0===e.result.duplicateGroupIndex)}e.foo.duplicatesDisplayed=null!==t.get("duplicatesDisplayed")&&t.get("duplicatesDisplayed"),e.duplicatesExpanded=!1,e.titlesExpanded=!1,n(),e.toggleTitleExpansion=function(){e.titlesExpanded=!e.titlesExpanded,e.$emit("toggleTitleExpansionUp",e.titlesExpanded,e.result.titleGroupIndicator)},e.toggleDuplicateExpansion=function(){e.duplicatesExpanded=!e.duplicatesExpanded,e.$emit("toggleDuplicateExpansionUp",e.duplicatesExpanded,e.result.hash)},e.$on("toggleTitleExpansionDown",function(t,a,r){e.result.titleGroupIndicator===r&&(e.titlesExpanded=a,n())}),e.$on("toggleDuplicateExpansionDown",function(t,a,r){e.result.hash===r&&(e.duplicatesExpanded=a,n())}),e.$on("duplicatesDisplayed",function(t,a){e.foo.duplicatesDisplayed=a,a||(e.duplicatesExpanded=!1),n()}),e.$on("calculateDisplayState",function(){n()})}(e,s),function(e,t){function n(){e.$emit("selectionUp",e.result,e.foo.selected)}e.foo.selected=!1,e.clickCheckbox=function(){n(),e.$emit("checkboxClicked",event,e.rowIndex,e.foo.selected,event.currentTarget)},e.$on("shiftClick",function(a,r,o,i,l,s){var c,u,d,p=$($(l).prop("parentNode")).prop("offsetTop"),f=$($(s).prop("parentNode")).prop("offsetTop"),h=$(t).prop("offsetTop");e.resultDisplayed&&(d=f,((u=p)<=(c=h)&&c<=d||u>=c&&c>=d)&&(e.foo.selected=!!i,n()))}),e.$on("invertSelection",function(){e.resultDisplayed&&(e.foo.selected=!e.foo.selected,n())}),e.$on("deselectAll",function(){e.resultDisplayed&&(e.foo.selected=!1,n())}),e.$on("selectAll",function(){e.resultDisplayed&&(e.foo.selected=!0,n())}),e.$on("toggleSelection",function(t,n,a){e.resultDisplayed&&n===e.result&&(e.foo.selected=a)})}(e,t),d=n,p=a,f=o,h=c,(u=e).showDetailsDl=h.getUserInfos().maySeeDetailsDl,u.showNfo=function(e){if(0!==e.has_nfo){var t=new URI("internalapi/nfo/"+e.searchResultId);return d.get(t.toString()).then(function(e){e.data.successful?e.data.hasNfo?u.openModal("lg",e.data.content):p.info("No NFO available"):p.error(e.data.content)})}},u.openModal=function(e,t){f.open({template:'<pre class="nfo"><span ng-bind-html="nfo"></span></pre>',controller:NfoModalInstanceCtrl,size:e,resolve:{nfo:function(){return t}}}).result.then()},u.getNfoTooltip=function(){return"YES"===u.result.hasNfo?"Show NFO":"MAYBE"===u.result.hasNfo?"Try to load NFO (may not be available)":"No NFO available"},m=i,e.downloadNzb=function(e){m.location.href=e.link},e.kify=function(){return function(e){return e>1e3?Math.round(e/1e3)+"k":e}},l.log("search-result")}}function NfoModalInstanceCtrl(e,t,n){e.nfo=n,e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss()}}function onFinishRender(e){return{link:function(e,t,n){!0===e.$last&&e.$emit("onFinishRender")}}}function dropdownMultiselectDirective(){return{scope:{selectedModel:"=",options:"=",settings:"=?",events:"=?"},transclude:{toggleDropdown:"?toggleDropdown"},templateUrl:"static/html/directives/multiselect-dropdown.html",controller:["$scope","$element","$filter","$document",function(e,t,n,a){console.log(e.options),console.log(e.selectedModel);var r=t.children()[0],o={showSelectedValues:!0,showSelectAll:!0,showDeselectAll:!0,noSelectedText:null},i={onToggleItem:angular.noop};angular.extend(i,e.events||[]),angular.extend(o,e.settings||[]),angular.extend(e,{settings:o,events:i}),e.buttonText="",o.buttonText?e.buttonText=o.buttonText:e.$watch("selectedModel",function(){o.showSelectedValues?0===e.selectedModel.length?e.settings.noSelectedText?e.buttonText=e.settings.noSelectedText:e.buttonText="None selected":e.selectedModel.length===e.options.length?e.buttonText="All selected":e.buttonText=e.selectedModel.join(", "):e.settings.noSelectedText&&0===e.selectedModel.length?e.buttonText=e.settings.noSelectedText:e.buttonText=e.selectedModel.length+" / "+e.options.length+" selected"},!0),e.open=!1,e.toggleDropdown=function(){e.open=!e.open},e.toggleItem=function(t){var n=e.selectedModel.indexOf(t.id),a=n>-1;a?e.selectedModel.splice(n,1):e.selectedModel.push(t.id),e.events.onToggleItem(t,!a)},e.selectAll=function(){e.selectedModel=_.pluck(e.options,"id")},e.deselectAll=function(){e.selectedModel.splice(0,e.selectedModel.length)},a.on("click",function(t){function n(e,t){var n=!1;return e.some(function(e){return e===t&&(n=!0,!0)}),n}if(e.open){for(var a=t.target.parentElement,o=!1;angular.isDefined(a)&&null!==a&&!o;)a.className.split&&n(a.className.split(" "),"multiselect-parent")&&!o&&a===r&&(o=!0),a=a.parentElement;o||e.$apply(function(){e.open=!1})}})}]}}function indexerSelectionButton(){return e.$inject=["$scope"],{templateUrl:"static/html/directives/indexer-selection-button.html",scope:{selectedIndexers:"=",availableIndexers:"=",btn:"@"},controller:e};function e(e){function t(t){e.deselectAll(),e.selectedIndexers.push.apply(e.selectedIndexers,_.pluck(_.filter(e.availableIndexers,t),"name"))}e.anyTorrentIndexersSelectable=_.any(e.availableIndexers,function(e){return"TORZNAB"===e.searchModuleType}),e.invertSelection=function(){_.forEach(e.availableIndexers,function(t){var n=_.indexOf(e.selectedIndexers,t.name);-1===n?e.selectedIndexers.push(t.name):e.selectedIndexers.splice(n,1)})},e.selectAll=function(){e.deselectAll(),e.selectedIndexers.push.apply(e.selectedIndexers,_.pluck(e.availableIndexers,"name"))},e.deselectAll=function(){e.selectedIndexers.splice(0,e.selectedIndexers.length)},e.reset=function(){t(function(e){return e.preselect})},e.selectAllUsenet=function(){t(function(e){return"TORZNAB"!==e.searchModuleType})},e.selectAllTorrent=function(){t(function(e){return"TORZNAB"===e.searchModuleType})}}}function indexerInput(){return e.$inject=["$scope"],{templateUrl:"static/html/directives/indexer-input.html",scope:{indexer:"=",model:"=",onClick:"="},replace:!0,controller:e};function e(e){e.isFocused=!1,e.onFocus=function(){e.isFocused=!0},e.onBlur=function(){e.isFocused=!1}}}function hydraupdates(){return e.$inject=["$scope","UpdateService"],{templateUrl:"static/html/directives/updates.html",controller:e};function e(e,t){e.loadingPromise=t.getInfos().then(function(t){e.currentVersion=t.data.currentVersion,e.repVersion=t.data.latestVersion,e.updateAvailable=t.data.updateAvailable,e.latestVersionIgnored=t.data.latestVersionIgnored,e.changelog=t.data.changelog}),t.getVersionHistory().then(function(t){e.versionHistory=t.data}),e.update=function(){t.update()},e.showChangelog=function(){t.showChanges(e.changelog)},e.forceUpdate=function(){t.update()}}}function hydraNews(){return e.$inject=["$scope","$http"],{templateUrl:"static/html/directives/news.html",controller:e};function e(e,t){return t.get("internalapi/news").success(function(t){e.news=t})}}function hydralog(){return e.$inject=["$scope","$http","$interval","$uibModal","$sce","localStorageService","growl"],{templateUrl:"static/html/directives/log.html",controller:e};function e(e,t,n,a,r,o,i){function l(n){return 0===e.active?t.get("internalapi/debuginfos/jsonlogs",{params:{offset:n,limit:500}}).success(function(t){e.jsonLogLines=angular.fromJson(t.lines),e.hasMoreJsonLines=t.hasMore}):1===e.active?t.get("internalapi/debuginfos/currentlogfile").success(function(t){e.log=r.trustAsHtml(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"))},function(e){i.error(e)}):2===e.active?t.get("internalapi/debuginfos/logfilenames").success(function(t){e.logfilenames=t}):void 0}function s(){e.tailInterval=n(function(){1===e.active&&(e.update(),e.doTailLog&&1===e.active&&e.scrollToBottom())},5e3)}e.tailInterval=null,e.doUpdateLog=null!==o.get("doUpdateLog")&&o.get("doUpdateLog"),e.doTailLog=null!==o.get("doTailLog")&&o.get("doTailLog"),e.active=0,e.currentJsonIndex=0,e.hasMoreJsonLines=!0,e.logPromise=l(),e.select=function(t){e.active=t,e.update()},e.scrollToBottom=function(){document.getElementById("logfile").scrollTop=1e7,document.getElementById("logfile").scrollTop=100001e3},e.update=function(){l(e.currentJsonIndex),1===e.active&&e.scrollToBottom()},e.getOlderFormatted=function(){l(e.currentJsonIndex+500).then(function(){e.currentJsonIndex+=500})},e.getNewerFormatted=function(){var t=Math.max(e.currentJsonIndex-500,0);l(t),e.currentJsonIndex=t},e.toggleUpdate=function(t){e.doUpdateLog=t,e.doUpdateLog?s():null!==e.tailInterval&&(console.log("Cancelling"),n.cancel(e.tailInterval),o.set("doTailLog",!1),e.doTailLog=!1),o.set("doUpdateLog",e.doUpdateLog)},e.toggleTailLog=function(){o.set("doTailLog",e.doTailLog)},e.openModal=function(e){a.open({templateUrl:"log-entry.html",controller:LogModalInstanceCtrl,size:"xl",resolve:{entry:function(){return e}}}).result.then()},e.$on("$destroy",function(){null!==e.tailInterval&&n.cancel(e.tailInterval)}),e.doUpdateLog&&s()}}function LogModalInstanceCtrl(e,t,n){e.entry=n,e.ok=function(){t.dismiss()}}function formatTimestamp(){return function(e){return moment(e).local().format("YYYY-MM-DD HH:mm")}}function escapeHtml(e){return function(t){return e(t)}}function formatClassname(){return function(e){return e.substr(e.lastIndexOf(".")+1)}}function focusOn(){return function(e,t,n){e.$on("focusOn",function(e,a){a===n.focusOn&&t[0].focus()})}}function downloadNzbzipButton(){return e.$inject=["$scope","growl","$http","FileDownloadService"],{templateUrl:"static/html/directives/download-nzbzip-button.html",require:["^searchResults"],scope:{searchResults:"<",searchTitle:"<",callback:"&"},controller:e};function e(e,t,n,a){e.download=function(){if(angular.isUndefined(e.searchResults)||0===e.searchResults.length)t.info("You should select at least one result...");else{var r=_.map(e.searchResults,function(e){return e.searchResultId}),o="internalapi/nzbzip",i="NZBHydra NZBs"+(angular.isDefined(e.searchTitle)?" for "+e.searchTitle.replace("[^a-zA-Z0-9.-]","_"):"")+".zip";n({method:"post",url:o,data:r}).success(function(n){n.successful&&null!==n.zip?(o="internalapi/nzbzipDownload",a.downloadFile(o,i,"POST",n.zipFilepath),angular.isDefined(e.callback)&&e.callback({result:n.addedIds}),n.missedIds.length>0&&t.error("Unable to add "+n.missedIds.length+" out of "+r.length+" NZBs to ZIP")):t.error(n.message)}).error(function(e,n,a,r){t.error(n)})}}}}function downloadNzbsButton(){return e.$inject=["$scope","$http","NzbDownloadService","ConfigService","growl"],{templateUrl:"static/html/directives/download-nzbs-button.html",require:["^searchResults"],scope:{searchResults:"<",callback:"&"},controller:e};function e(e,t,n,a,r){e.downloaders=n.getEnabledDownloaders(),e.blackholeEnabled=null!==a.getSafe().downloading.saveTorrentsTo,e.download=function(t){if(angular.isUndefined(e.searchResults)||0===e.searchResults.length)r.info("You should select at least one result...");else{var a=!1,o=!1,i=_.filter(e.searchResults,function(e){return"NZB"===e.downloadType?(o=!0,!0):(console.log("Not sending torrent result to downloader"),a=!0,!1)});if(a&&!o)return r.info("None of the selected results were NZBs. Adding aborted"),void(angular.isDefined(e.callback)&&e.callback({result:[]}));a&&o&&r.info("Some the selected results are torrent results which were skipped");var l=_.map(i,function(e){return{searchResultId:e.searchResultId,originalCategory:e.originalCategory}});n.download(t,l).then(function(t){angular.isDefined(t.data)&&("dismissed"!==t?t.data.successful?r.info("Successfully added all NZBs"):r.error(t.data.message):r.error("Error while adding NZBs"),angular.isDefined(e.callback)&&e.callback({result:t.data.addedIds}))},function(){r.error("Error while adding NZBs")})}},e.sendToBlackhole=function(){var n=!1,a=!1,o=_.filter(e.searchResults,function(e){return"TORRENT"===e.downloadType?(a=!0,!0):(console.log("Not sending NZB result to black hole"),n=!0,!1)});if(n&&!a)return r.info("None of the selected results were torrents. Adding aborted"),void(angular.isDefined(e.callback)&&e.callback({result:[]}));n&&a&&r.info("Some the selected results are NZB results which were skipped");var i=_.pluck(o,"searchResultId");t.put("internalapi/saveTorrent",i).then(function(t){t.data.successful?r.info("Successfully saved all torrents"):r.error(t.data.message),angular.isDefined(e.callback)&&e.callback({result:t.data.addedIds})})}}}function columnFilterWrapper(){return e.$inject=["$scope","DebugService"],{restrict:"E",templateUrl:"static/html/dataTable/columnFilterOuter.html",transclude:!0,controllerAs:"columnFilterWrapperCtrl",scope:!0,bindToController:!0,controller:e,link:function(e,t,n){e.element=t}};function e(e,t){var n=this;n.open=!1,n.isActive=!1,n.toggle=function(){n.open=!n.open,n.open&&e.$broadcast("opened")},n.clear=function(){n.open&&e.$broadcast("clear")},e.$on("filter",function(e,t,a,r){n.open=!1,n.isActive=r}),t.log("filter-wrapper")}}function freetextFilter(e){return t.$inject=["$scope","focus"],{template:"<ng-include src=\"'static/html/dataTable/columnFilterFreetext.html'\"/>",require:"^columnFilterWrapper",controllerAs:"innerController",scope:{column:"@"},controller:t};function t(t,n){t.data={},t.$on("opened",function(){n("freetext-filter-input")}),t.onKeypress=function(e){13===e.which&&t.$emit("filter",t.column,{filterValue:t.data.filter,filterType:"freetext"},angular.isDefined(t.data.filter)&&t.data.filter.length>0)},e.log("filter-freetext")}}function checkboxesFilter(){return e.$inject=["$scope","DebugService"],{template:"<ng-include src=\"'static/html/dataTable/columnFilterCheckboxes.html'\"/>",controllerAs:"checkboxesFilterController",scope:{column:"@",entries:"<",preselect:"<",showInvert:"<",isBoolean:"<"},controller:e};function e(e,t){e.selected={entries:[]},e.active=!1,e.preselect&&e.selected.entries.push.apply(e.selected.entries,e.entries),e.invert=function(){e.selected.entries=_.difference(e.entries,e.selected.entries)},e.selectAll=function(){e.selected.entries.push.apply(e.selected.entries,e.entries)},e.deselectAll=function(){e.selected.entries.splice(0,e.selected.entries.length)},e.apply=function(){e.active=e.selected.entries.length<e.entries.length,e.$emit("filter",e.column,{filterValue:_.pluck(e.selected.entries,"id"),filterType:"checkboxes",isBoolean:e.isBoolean},e.active)},e.clear=function(){e.selectAll(),e.active=!1,e.$emit("filter",e.column,{filterValue:void 0,filterType:"checkboxes",isBoolean:e.isBoolean},e.active)},e.$on("clear",e.clear),t.log("filter-checkboxes")}}function booleanFilter(e){return t.$inject=["$scope"],{template:"<ng-include src=\"'static/html/dataTable/columnFilterBoolean.html'\"/>",controllerAs:"booleanFilterController",scope:{column:"@",options:"<",preselect:"@"},controller:t};function t(t){t.selected={value:t.options[t.preselect].value},t.active=!1,t.apply=function(){t.active=t.selected.value!==t.options[0].value,t.$emit("filter",t.column,{filterValue:t.selected.value,filterType:"boolean"},t.active)},t.clear=function(){t.selected.value=!0,t.active=!1,t.$emit("filter",t.column,{filterValue:void 0,filterType:"boolean"},t.active)},t.$on("clear",t.clear),e.log("filter-boolean")}}function timeFilter(){return e.$inject=["$scope","DebugService"],{template:"<ng-include src=\"'static/html/dataTable/columnFilterTime.html'\"/>",scope:{column:"@",selected:"<"},controller:e};function e(e,t){e.dateOptions={dateDisabled:!1,formatYear:"yy",startingDay:1},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0],e.altInputFormats=["M!/d!/yyyy"],e.active=!1,e.openAfter=function(){e.after.opened=!0},e.openBefore=function(){e.before.opened=!0},e.after={opened:!1},e.before={opened:!1},e.apply=function(){e.active=e.selected.beforeDate||e.selected.afterDate,e.$emit("filter",e.column,{filterValue:{after:e.selected.afterDate,before:e.selected.beforeDate},filterType:"time"},e.active)},e.clear=function(){e.selected.beforeDate=void 0,e.selected.afterDate=void 0,e.active=!1,e.$emit("filter",e.column,{filterValue:void 0,filterType:"time"},e.active)},e.$on("clear",e.clear),t.log("filter-time")}}function numberRangeFilter(){return e.$inject=["$scope","DebugService"],{template:"<ng-include src=\"'static/html/dataTable/columnFilterNumberRange.html'\"/>",scope:{column:"@",min:"<",max:"<",addon:"@"},controller:e};function e(e,t){function n(){e.active=e.filterValue.min||e.filterValue.max,e.$emit("filter",e.column,{filterValue:e.filterValue,filterType:"numberRange"},e.active)}e.filterValue={min:void 0,max:void 0},e.active=!1,e.clear=function(){e.filterValue={min:void 0,max:void 0},e.active=!1,e.$emit("filter",e.column,{filterValue:void 0,filterType:"numberRange",isBoolean:e.isBoolean},e.active)},e.$on("clear",e.clear),e.apply=function(){n()},e.onKeypress=function(e){13===e.which&&n()},t.log("filter-number")}}function columnSortable(){return e.$inject=["$scope"],{restrict:"E",templateUrl:"static/html/dataTable/columnSortable.html",transclude:!0,scope:{sortMode:"<",column:"@",reversed:"<",startMode:"<"},controller:e};function e(e){angular.isUndefined(e.sortMode)&&(e.sortMode=0),angular.isUndefined(e.startMode)&&(e.startMode=1),e.sortModel={sortMode:e.sortMode,column:e.column,reversed:e.reversed,startMode:e.startMode,active:!1},e.$on("newSortColumn",function(t,n,a){e.sortModel.active=n===e.sortModel.column,n!==e.sortModel.column?e.sortModel.sortMode=0:e.sortModel.sortMode=a}),e.sort=function(){0===e.sortModel.sortMode||angular.isUndefined(e.sortModel.sortMode)?e.sortModel.sortMode=e.sortModel.startMode:1===e.sortModel.sortMode?e.sortModel.sortMode=2:e.sortModel.sortMode=1,e.$emit("sort",e.sortModel.column,e.sortModel.sortMode,e.sortModel.reversed)}}}function connectionTest(){return e.$inject=["$scope"],{templateUrl:"static/html/directives/connection-test.html",require:["^type","^data"],scope:{type:"=",id:"=",data:"=",downloader:"="},controller:e};function e(e){e.message="";var t="#button-test-connection",n="#message-test-connection";function a(){angular.element(t).removeClass("btn-default"),angular.element(t).removeClass("btn-success"),angular.element(t).addClass("btn-danger")}e.testConnection=function(){angular.element(t).addClass("glyphicon-refresh-animate");var r,o,i=angular.injector(["ng"]).get("$http");"downloader"===e.type?(r="internalapi/test_downloader",o={name:e.downloader,username:e.data.username,password:e.data.password},"SABNZBD"===e.downloader?(o.apiKey=e.data.apiKey,o.url=e.data.url):(o.host=e.data.host,o.port=e.data.port,o.ssl=e.data.ssl)):"newznab"===e.data.type&&(r="internalapi/test_newznab",o={host:e.data.host,apiKey:e.data.apiKey},angular.isDefined(e.data.username)&&(o.username=e.data.username,o.password=e.data.password)),i.get(r,{params:o}).success(function(e){e.successful?(angular.element(n).text(""),angular.element(t).removeClass("btn-default"),angular.element(t).removeClass("btn-danger"),angular.element(t).addClass("btn-success")):(angular.element(n).text(e.message),a())}).error(function(){angular.element(n).text(result.message),a()}).finally(function(){angular.element(t).removeClass("glyphicon-refresh-animate")})}}}function childOf(e,t){for(;(e=e.parentNode)&&e!==t;);return!!e}function clickOutside(e,t,n){return{restrict:"A",link:function(a,r,o){n(function(){var i=void 0!==o.outsideIfNot?o.outsideIfNot.split(/[ ,]+/):[];function l(e){var l,s,c,u,d,p;if(!angular.element(r).hasClass("ng-hide")&&(e&&e.target&&!(angular.isDefined(o.outsideIgnore)&&a.$eval(o.outsideIgnore)||childOf(e.target,r.context)))){for(s=e.target;s;s=s.parentNode){if(s===r[0])return;if(u=s.id,d=s.className,p=i.length,d&&void 0!==d.baseVal&&(d=d.baseVal),d||u)for(l=0;l<p;l++)if(c=new RegExp("\\b"+i[l]+"\\b"),void 0!==u&&u===i[l]||d&&c.test(d))return}n(function(){t(o.clickOutside)(a,{event:e})})}}function s(){return"ontouchstart"in window||navigator.maxTouchPoints}s()&&e.on("touchstart",l),e.on("click",l),a.$on("$destroy",function(){s()&&e.off("touchstart",l),e.off("click",l)})})}}}function cfgFormEntry(){return{templateUrl:"static/html/directives/cfg-form-entry.html",require:["^title","^cfg"],scope:{title:"@",cfg:"=",help:"@",type:"@?",options:"=?"},controller:["$scope","$element","$attrs",function(e,t,n){e.type=angular.isDefined(e.type)?e.type:"text",e.options=angular.isDefined(e.type)?e.$eval(n.options):[]}]}}function hydrabackup(){return e.$inject=["$scope","BackupService","Upload","FileDownloadService","$http","RequestsErrorHandler","growl","RestartService"],{templateUrl:"static/html/directives/backup.html",controller:e};function e(e,t,n,a,r,o,i,l){e.refreshBackupList=function(){t.getBackupsList().then(function(t){e.backups=t})},e.refreshBackupList(),e.uploadActive=!1,e.createBackupFile=function(){r.get("internalapi/backup/backuponly",{params:{dontdownload:!0}}).then(function(){e.refreshBackupList()})},e.createAndDownloadBackupFile=function(){a.downloadFile("internalapi/backup/backup","nzbhydra-backup-"+moment().format("YYYY-MM-DD-HH-mm")+".zip","GET").then(function(){e.refreshBackupList()})},e.uploadBackupFile=function(t,a){o.specificallyHandled(function(){e.file=t,e.errFile=a&&a[0],t&&(e.uploadActive=!0,t.upload=n.upload({url:"internalapi/backup/restorefile",file:t}),t.upload.then(function(n){e.uploadActive=!1,t.result=n.data,l.restart("Restore successful.")},function(t){e.uploadActive=!1,i.error(t.data)},function(e){t.progress=Math.min(100,parseInt(100*e.loaded/e.total)),t.loaded=Math.floor(e.loaded/1024),t.total=Math.floor(e.total/1024)}))})},e.restoreFromFile=function(e){t.restoreFromFile(e).then(function(){l.restart("Extraction of backup successful. Restarting for wrapper to restore data.")},function(e){i.error(e.data)})}}}function addableNzbs(e){return t.$inject=["$scope","NzbDownloadService"],{templateUrl:"static/html/directives/addable-nzbs.html",require:[],scope:{searchresult:"<",alwaysAsk:"<"},controller:t};function t(t,n){t.alwaysAsk="true"===t.alwaysAsk,console.log(t.alwaysAsk),t.downloaders=_.filter(n.getEnabledDownloaders(),function(e){return"NZB"===t.searchresult.downloadType||e.downloadType===t.searchresult.downloadType}),e.log("addable-nzbs")}}function addableNzb(e){return t.$inject=["$scope","NzbDownloadService","growl"],{templateUrl:"static/html/directives/addable-nzb.html",scope:{searchresult:"=",downloader:"<",alwaysAsk:"<"},controller:t};function t(e,t,n){e.downloader.iconCssClass?e.cssClass="fa fa-"+e.downloader.iconCssClass.replace("fa-","").replace("fa ",""):e.cssClass="SABNZBD"===e.downloader.downloaderType?"sabnzbd":"nzbget",e.add=function(){var a=e.cssClass;e.cssClass="nzb-spinning",t.download(e.downloader,[{searchResultId:e.searchresult.searchResultId?e.searchresult.searchResultId:e.searchresult.id,originalCategory:e.searchresult.originalCategory}],e.alwaysAsk).then(function(t){"dismissed"!==t?t.data.successful?e.cssClass="SABNZBD"===e.downloader.downloaderType?"sabnzbd-success":"nzbget-success":(e.cssClass="SABNZBD"===e.downloader.downloaderType?"sabnzbd-error":"nzbget-error",n.error("Unable to add NZB. Make sure the downloader is running and properly configured.")):e.cssClass=a},function(){e.cssClass="SABNZBD"===e.downloader.downloaderType?"sabnzbd-error":"nzbget-error",n.error("An unexpected error occurred while trying to contact NZBHydra or add the NZB.")})}}}function UpdateService(e,t,n,a,r,o,i){return{update:function(){var n=o.open({templateUrl:"static/html/update-modal.html",controller:"UpdateModalInstanceCtrl",size:"md",backdrop:"static",keyboard:!1});e.put("internalapi/updates/installUpdate").then(function(){i(function(){a.startCountdown(""),n.close()},2e3)},function(){t.info("An error occurred while updating. Please check the logs."),n.close()})},showChanges:function(){return e.get("internalapi/updates/changesSince").then(function(e){var t={size:"lg",templateUrl:"static/html/changelog-modal.html",resolve:{versionHistory:function(){return e.data}},controller:function(e,t,n,a){e.versionHistory=a,e.ok=function(){n.dismiss()}}},n=o.open(t);n.result.then()})},getInfos:function(){return r.specificallyHandled(function(){return e.get("internalapi/updates/infos").then(function(e){return e.data.currentVersion,e.data.latestVersion,e.data.updateAvailable,e.data.latestVersionIgnored,e})})},getVersionHistory:function(){return e.get("internalapi/updates/versionHistory").then(function(e){return e.data,e})},ignore:function(t){return e.put("internalapi/updates/ignore?version="+t).then(function(e){return e})}}}function UpdateModalInstanceCtrl(e,t,n,a){e.messages=[];var r=n(function(){a.specificallyHandled(function(){t.get("internalapi/updates/messages").then(function(t){e.messages=t.data})})},200);e.$on("$destroy",function(){null!==r&&n.cancel(r)})}function UpdateFooterController(e,t,n,a,r,o,i){e.updateAvailable=!1,e.checked=!1;function l(){e.checked=!0,t.getInfos().then(function(t){e.currentVersion=t.data.currentVersion,e.latestVersion=t.data.latestVersion,e.updateAvailable=t.data.updateAvailable,e.changelog=t.data.changelog})}function s(){n.specificallyHandled(function(){i.getSafe().showNews&&r.get("internalapi/news/forcurrentversion").then(function(e){e&&e.length>0&&(o.open({templateUrl:"static/html/news-modal.html",controller:NewsModalInstanceCtrl,size:"lg",resolve:{news:function(){return e}}}),r.put("internalapi/news/saveshown"))})})}e.mayUpdate=a.getUserInfos().maySeeAdmin,e.$on("user:loggedIn",function(){a.getUserInfos().maySeeAdmin&&!e.checked&&l()}),e.mayUpdate&&l(),e.update=function(){t.update()},e.ignore=function(){t.ignore(e.latestVersion)},e.showChangelog=function(){t.showChanges()},n.specificallyHandled(function(){r.get("internalapi/welcomeshown").success(function(e){if(e)_.defer(s);else{r.put("internalapi/welcomeshown");var t=o.open({templateUrl:"static/html/welcome-modal.html",controller:WelcomeModalInstanceCtrl,size:"md"});t.opened.then(function(){!0}),t.closed.then(function(){!1})}})})}function NewsModalInstanceCtrl(e,t,n){e.news=n,e.close=function(){t.dismiss()}}function WelcomeModalInstanceCtrl(e,t,n,a){e.close=function(){t.dismiss()},e.startMigration=function(){t.dismiss(),a.migrate()},e.goToConfig=function(){t.dismiss(),n.go("root.config.main")}}function SystemController(e,t,n,a,r,o,i,l,s){e.activeTab=n,e.foo={csv:"",sql:""},e.shutdown=function(){s.shutdown().then(function(){r.info("Shutdown initiated. Cya!")},function(){r.info("Unable to send shutdown command.")})},e.restart=function(){o.restart()},e.reloadConfig=function(){l.reloadConfig().then(function(){r.info("Successfully reloaded config. Some setting may need a restart to take effect.")},function(e){r.error(e.message)})},e.migrate=function(){i.migrate()},e.allTabs=[{active:!1,state:"root.system.control",name:"Control"},{active:!1,state:"root.system.updates",name:"Updates"},{active:!1,state:"root.system.log",name:"Log"},{active:!1,state:"root.system.tasks",name:"Tasks"},{active:!1,state:"root.system.backup",name:"Backup"},{active:!1,state:"root.system.bugreport",name:"Bugreport / Debug"},{active:!1,state:"root.system.news",name:"News"},{active:!1,state:"root.system.about",name:"About"}],e.goToSystemState=function(n){t.go(e.allTabs[n].state,{activeTab:n},{inherit:!1,notify:!0,reload:!0})},e.downloadDebuggingInfos=function(){a({method:"GET",url:"internalapi/debuginfos/logandconfig",responseType:"arraybuffer"}).success(function(e,t,n,a){var r=document.createElement("a"),o=new Blob([e],{type:"application/octet-stream"});r.href=URL.createObjectURL(o),r.download="nzbhydra-debuginfos-"+moment().format("YYYY-MM-DD-HH-mm")+".zip",document.body.appendChild(r),r.click(),document.body.removeChild(r)})},e.executeSqlQuery=function(){a.post("internalapi/debuginfos/executesqlquery",e.foo.sql).success(function(t){t.successful?e.foo.csv=t.message:r.error(t.message)})},e.executeSqlUpdate=function(){a.post("internalapi/debuginfos/executesqlupdate",e.foo.sql).success(function(t){t.successful?e.foo.csv=t.message+" rows affected":r.error(t.message)})}}function StatsService(e){return{get:function(t,n,a,r){var o={after:t,before:n,includeDisabled:a};return o=_.extend(o,r),e.post("internalapi/stats",o).success(function(e){return e.data})},getDownloadHistory:function(t,n,a,r){var o={page:t,limit:n,filterModel:a};angular.isUndefined(t)&&(o.page=1);angular.isUndefined(n)&&(o.limit=100);angular.isUndefined(a)&&(o.filterModel={});angular.isUndefined(r)?o.sortModel={column:"time",sortMode:2}:o.sortModel=r;return e.post("internalapi/history/downloads",o).success(function(e){return{nzbDownloads:e.content,totalDownloads:e.totalElements}})}}}function StatsController(e,t,n,a,r,o,i,l){e.dateOptions={dateDisabled:!1,formatYear:"yy",startingDay:1};var s=!0,c=!0;e.afterDate=moment().subtract(30,"days").toDate(),e.beforeDate=moment().add(1,"days").toDate();var u="USERNAME"===l.getSafe().logging.historyUserInfoType||"BOTH"===l.getSafe().logging.historyUserInfoType,d="IP"===l.getSafe().logging.historyUserInfoType||"BOTH"===l.getSafe().logging.historyUserInfoType;function p(t){a.start("Updating stats...");var r=null!==e.afterDate?e.afterDate:null,l=null!==e.beforeDate?e.beforeDate:null,s={};angular.isDefined(t)?s[t]=!0:s=e.foo.statsSwichState,e.statsLoadingPromise=n.get(r,l,e.foo.includeDisabledIndexersInStats,s).then(function(t){e.setStats(t),o(function(){i.dispatchEvent(new Event("resize"))},500)}),a.reset()}function f(e,t,n,a,r,o){return{options:{chart:{type:e,height:350,margin:{top:20,right:20,bottom:100,left:50},x:function(e){return e[n]},y:function(e){return e[a]},showValues:!0,valueFormat:function(e){return e},color:function(){return"red"},showControls:!1,showLegend:!1,duration:100,xAxis:{axisLabel:r,tickFormat:function(e){return e},rotateLabels:30,showMaxMin:!1,color:function(){return"white"}},yAxis:{axisLabel:o,axisLabelDistance:-10,tickFormat:function(e){return e}},tooltip:{enabled:!1},zoom:{enabled:!0,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!1,verticalOff:!0,unzoomEventType:"dblclick.zoom"}}},data:[{key:"doesntmatter",bar:!0,values:t}]}}e.foo={includeDisabledIndexersInStats:null!==r.get("includeDisabledIndexersInStats")&&r.get("includeDisabledIndexersInStats"),statsSwichState:null!==r.get("statsSwitchState")?r.get("statsSwitchState"):{indexerApiAccessStats:!0,avgIndexerSearchResultsShares:!0,avgResponseTimes:!0,indexerDownloadShares:!0,downloadsPerDayOfWeek:!0,downloadsPerHourOfDay:!0,searchesPerDayOfWeek:!0,searchesPerHourOfDay:!0,downloadsPerAgeStats:!0,successfulDownloadsPerIndexer:!0,downloadSharesPerUser:u,searchSharesPerUser:d,downloadSharesPerIp:!0,searchSharesPerIp:!0,userAgentSearchShares:!0,userAgentDownloadShares:!0}},r.set("statsSwitchState",e.foo.statsSwichState),e.stats={},p(),e.openAfter=function(){e.after.opened=!0},e.openBefore=function(){e.before.opened=!0},e.after={opened:!1},e.before={opened:!1},e.toggleIncludeDisabledIndexers=function(){r.set("includeDisabledIndexersInStats",e.foo.includeDisabledIndexersInStats)},e.onStatsSwitchToggle=function(t){r.set("statsSwitchState",e.foo.statsSwichState),e.foo.statsSwichState[t]&&p(t)},e.refresh=function(){p()},e.$watch("beforeDate",function(){c&&(c=!1)}),e.$watch("afterDate",function(){s&&(s=!1)}),e.onKeypress=function(e){e.which},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0],e.altInputFormats=["M!/d!/yyyy"],e.setStats=function(n){if(n=n.data,_.forEach(n,function(t,n){null!==t&&(e.stats[n]=t)}),e.stats.avgResponseTimes&&(e.avgResponseTimesChart=f("multiBarHorizontalChart",e.stats.avgResponseTimes,"indexer","avgResponseTime","","Response time"),e.avgResponseTimesChart.options.chart.margin.left=100,e.avgResponseTimesChart.options.chart.yAxis.rotateLabels=-30,e.avgResponseTimesChart.options.chart.height=Math.max(30*e.stats.avgResponseTimes.length,350)),e.stats.avgIndexerSearchResultsShares){e.resultsSharesChart={options:{chart:{type:"multiBarChart",height:350,margin:{top:20,right:20,bottom:100,left:45},clipEdge:!0,duration:500,stacked:!1,reduceXTicks:!1,showValues:!0,tooltip:{enabled:!0,valueFormatter:function(e){return t("number")(e,2)+"%"}},showControls:!1,xAxis:{axisLabel:"",showMaxMin:!1,rotateLabels:30,axisLabelDistance:30,tickFormat:function(e){return e}},yAxis:{axisLabel:"Share (%)",axisLabelDistance:-20,tickFormat:function(e){return t("number")(e,0)+"%"}}}},data:[{key:"Results",values:_.map(e.stats.avgIndexerSearchResultsShares,function(e){return{series:0,y:e.totalShare,x:e.indexerName}})},{key:"Unique results",values:_.map(e.stats.avgIndexerSearchResultsShares,function(e){return{series:1,y:e.uniqueShare,x:e.indexerName}})}]};var a=30;(e.foo.includeDisabledIndexersInStats?n.numberOfConfiguredIndexers:n.numberOfEnabledIndexers)>30&&(a=70),e.resultsSharesChart.options.chart.xAxis.rotateLabels=a,e.resultsSharesChart.options.chart.height=350}function r(e,n,a,r){return{options:{chart:{type:"pieChart",height:n,x:function(e){return e[a]},y:function(e){return e[r]},showLabels:!0,donut:!0,donutRatio:.35,duration:500,labelThreshold:.03,labelsOutside:!0,labelSunbeamLayout:!0,tooltip:{valueFormatter:function(e,n){return t("number")(e,2)+"%"}},legend:{margin:{top:5,right:35,bottom:5,left:0}}}},data:e}}e.stats.downloadsPerHourOfDay&&(e.downloadsPerHourOfDayChart=f("discreteBarChart",e.stats.downloadsPerHourOfDay,"hour","count","Hour of day","Downloads"),e.downloadsPerHourOfDayChart.options.chart.xAxis.rotateLabels=0),e.stats.downloadsPerDayOfWeek&&(e.downloadsPerDayOfWeekChart=f("discreteBarChart",e.stats.downloadsPerDayOfWeek,"day","count","Day of week","Downloads"),e.downloadsPerDayOfWeekChart.options.chart.xAxis.rotateLabels=0),e.stats.searchesPerHourOfDay&&(e.searchesPerHourOfDayChart=f("discreteBarChart",e.stats.searchesPerHourOfDay,"hour","count","Hour of day","Searches"),e.searchesPerHourOfDayChart.options.chart.xAxis.rotateLabels=0),e.stats.searchesPerDayOfWeek&&(e.searchesPerDayOfWeekChart=f("discreteBarChart",e.stats.searchesPerDayOfWeek,"day","count","Day of week","Searches"),e.searchesPerDayOfWeekChart.options.chart.xAxis.rotateLabels=0),e.stats.downloadsPerAgeStats&&(e.downloadsPerAgeChart=f("discreteBarChart",e.stats.downloadsPerAgeStats.downloadsPerAge,"age","count","Downloads per age","Downloads"),e.downloadsPerAgeChart.options.chart.xAxis.rotateLabels=45,e.downloadsPerAgeChart.options.chart.showValues=!1),e.stats.successfulDownloadsPerIndexer&&(e.successfulDownloadsPerIndexerChart=f("multiBarHorizontalChart",e.stats.successfulDownloadsPerIndexer,"indexerName","percentSuccessful","Indexer","% successful"),e.successfulDownloadsPerIndexerChart.options.chart.xAxis.rotateLabels=90,e.successfulDownloadsPerIndexerChart.options.chart.yAxis.tickFormat=function(e){return t("number")(e,0)},e.successfulDownloadsPerIndexerChart.options.chart.valueFormat=function(e){return t("number")(e,0)},e.successfulDownloadsPerIndexerChart.options.chart.showValues=!0),e.stats.indexerDownloadShares&&(e.indexerDownloadSharesChart={options:{chart:{type:"pieChart",height:500,x:function(e){return e.indexerName},y:function(e){return e.share},showLabels:!0,donut:!0,donutRatio:.35,duration:500,labelThreshold:.03,labelSunbeamLayout:!0,tooltip:{valueFormatter:function(e,n){return t("number")(e,2)+"%"}},legend:{margin:{top:5,right:35,bottom:5,left:0}}}},data:e.stats.indexerDownloadShares},e.indexerDownloadSharesChart.options.chart.height=Math.min(Math.max(40*(e.foo.includeDisabledIndexersInStats?e.stats.numberOfConfiguredIndexers:e.stats.numberOfEnabledIndexers),350),900)),null!==e.stats.searchSharesPerIp&&(e.downloadSharesPerIpChart=r(e.stats.downloadSharesPerIp,300,"key","percentage")),null!==e.stats.searchSharesPerIpChart&&(e.searchSharesPerIpChart=r(e.stats.searchSharesPerIp,300,"key","percentage")),null!==e.stats.searchSharesPerUser&&(e.downloadSharesPerUserChart=r(e.stats.downloadSharesPerUser,300,"key","percentage")),null!==e.stats.searchSharesPerUserChart&&(e.searchSharesPerUserChart=r(e.stats.searchSharesPerUser,300,"key","percentage")),e.stats.userAgentSearchShares&&(e.userAgentSearchSharesChart=r(e.stats.userAgentSearchShares,300,"userAgent","percentage"),e.userAgentSearchSharesChart.options.chart.legend.margin.bottom=25),e.stats.userAgentDownloadShares&&(e.userAgentDownloadSharesChart=r(e.stats.userAgentDownloadShares,300,"userAgent","percentage"),e.userAgentDownloadSharesChart.options.chart.legend.margin.bottom=25)}}function SearchService(e){var t,n,a,r;return{search:function(a,r,i,l,s,c,u,d,p,f,h,m){var g=new URI("internalapi/search"),y={};y.searchRequestId=a,y.query=i,y.minsize=u,y.maxsize=d,y.minage=p,y.maxage=f,y.category=r,angular.isUndefined(h)||null===h||(y.indexers=h.split(","));l&&(y.title=l.title,r.indexOf("Movies")>-1||0===r.indexOf("20")||"movie"===m?(y.tmdbId=l.tmdbId,y.imdbId=l.imdbId):(r.indexOf("TV")>-1||0===r.indexOf("50")||"tvsearch"===m)&&(y.tvdbId=l.tvdbId,y.tvrageid=l.rid,y.tvmazeid=l.rid,y.season=s,y.episode=c));return t=g,n=y,e.post(g.toString(),y).then(o)},getLastResults:function(){return a},loadMore:function(a,r,i){return n.offset=a,n.limit=r,n.loadAll=!!angular.isDefined(i)&&i,e.post(t.toString(),n).then(o)},getSearchState:function(t){return e.get("internalapi/search/state",{params:{searchrequestid:t}})},getModalInstance:function(){return r},setModalInstance:function(e){r=e}};function o(e){var t=e.data.searchResults,n=e.data.indexerSearchMetaDatas,r=e.data.numberOfAvailableResults,o=e.data.numberOfRejectedResults,i=e.data.numberOfAcceptedResults,l=e.data.numberOfProcessedResults,s=e.data.rejectedReasonsMap,c=e.data.notPickedIndexersWithReason;return a={searchResults:t,indexerSearchMetaDatas:n,numberOfAvailableResults:r,numberOfAcceptedResults:i,numberOfRejectedResults:o,numberOfProcessedResults:l,rejectedReasonsMap:s,notPickedIndexersWithReason:c}}}function SearchResultsController(e,t,n,a,r,o,i,l,s,c,u,d){d.log("foobar"),t.limitTo=100,t.offset=0,t.indexersearches=s.getLastResults().indexerSearchMetaDatas,t.notPickedIndexersWithReason=[],_.forEach(s.getLastResults().notPickedIndexersWithReason,function(e,n){t.notPickedIndexersWithReason.push({indexer:n,reason:e})}),t.indexerResultsInfo={},t.groupExpanded={},t.selected=[],e.title?t.searchTitle=e.title:e.query?t.searchTitle=e.query:t.searchTitle=void 0,t.selectedIds=_.map(t.selected,function(e){return e.searchResultId}),t.lastClickedRowIndex=null,t.lastClickedValue=null;var p=[],f={};t.filterModel={},t.isShowFilterButtons=c.getSafe().searching.showQuickFilterButtons,t.isShowFilterButtonsMovie=t.isShowFilterButtons&&e.category.toLowerCase().indexOf("movie")>-1,t.isShowFilterButtonsTv=t.isShowFilterButtons&&e.category.toLowerCase().indexOf("tv")>-1,t.filterButtonsModel={source:{},quality:{}},t.filterButtonsModelMap={tv:["hdtv"],camts:["cam","ts"],web:["webrip","web-dl","webdl"],dvd:["dvd"],bluray:["bluray","blu-ray"]},f=null!==l.get("sorting")?l.get("sorting"):{column:"epoch",sortMode:2,reversed:!1},a(function(){t.$broadcast("newSortColumn",f.column,f.sortMode,f.reversed)},10),t.foo={indexerStatusesExpanded:null!==l.get("indexerStatusesExpanded")&&l.get("indexerStatusesExpanded"),duplicatesDisplayed:null!==l.get("duplicatesDisplayed")&&l.get("duplicatesDisplayed"),groupTorrentAndNewznabResults:null!==l.get("groupTorrentAndNewznabResults")&&l.get("groupTorrentAndNewznabResults"),sumGrabs:null===l.get("sumGrabs")||l.get("sumGrabs"),scrollToResults:null===l.get("scrollToResults")||l.get("scrollToResults")},t.loadMoreEnabled=!1,t.totalAvailableUnknown=!1,t.expandedTitlegroups=[],t.optionsOptions=[{id:"duplicatesDisplayed",label:"Show duplicate display triggers"},{id:"groupTorrentAndNewznabResults",label:"Group torrent and usenet results"},{id:"sumGrabs",label:"Use sum of grabs / seeders for filtering / sorting of groups"},{id:"scrollToResults",label:"Scroll to results when finished"}],t.optionsSelectedModel=[];for(var h in t.optionsOptions)t.foo[t.optionsOptions[h].id]&&t.optionsSelectedModel.push(t.optionsOptions[h].id);function m(){g("Sorting / filtering...").then(function(){t.filteredResults=v(p),l.set("sorting",f)})}function g(e){var t=n.defer();return o.start(e),a(function(){t.resolve()},10),t.promise}function y(e){return e.title.toLowerCase().replace(/[\s\-\._]/gi,"")}function b(e){var n=y(e);return t.foo.groupTorrentAndNewznabResults||(n+=e.downloadType),n}function v(e){var n,a;"title"in t.filterModel&&(n=t.filterModel.title.filterValue,a=n.toLowerCase().split(/[\s.\-]+/));var r=f.column,o=f.reversed;function i(e){return"grabs"===r?null!==e.seeders?e.seeders:null!==e.grabs?e.grabs:0:"title"===r?y(e):"indexer"===r?e.indexer.toLowerCase():e[r]}var l=_.filter(e,function(e){if("size"in t.filterModel){var n=t.filterModel.size.filterValue;if(angular.isDefined(n.min)&&e.size/1024/1024<n.min)return!1;if(angular.isDefined(n.max)&&e.size/1024/1024>n.max)return!1}if("epoch"in t.filterModel){n=t.filterModel.epoch.filterValue;var r=moment.utc().diff(moment.unix(e.epoch),"days");if(angular.isDefined(n.min)&&r<n.min)return!1;if(angular.isDefined(n.max)&&r>n.max)return!1}if("grabs"in t.filterModel){if(n=t.filterModel.grabs.filterValue,angular.isDefined(n.min)&&(null!==e.seeders&&e.seeders<n.min||null===e.seeders&&null!==e.grabs&&e.grabs<n.min))return!1;if(angular.isDefined(n.max)&&(null!==e.seeders&&e.seeders>n.max||null===e.seeders&&null!==e.grabs&&e.grabs>n.max))return!1}if("title"in t.filterModel&&!_.every(a,function(t){return e.title.toLowerCase().indexOf(t)>-1}))return!1;if("indexer"in t.filterModel&&-1===_.indexOf(t.filterModel.indexer.filterValue,e.indexer))return!1;if("category"in t.filterModel&&-1===_.indexOf(t.filterModel.category.filterValue,e.category))return!1;if(null!==t.filterButtonsModel.source){var o=[];if(_.each(t.filterButtonsModel.source,function(e,n){e&&Array.prototype.push.apply(o,t.filterButtonsModelMap[n])}),o.length>0&&!(i=_.any(o,function(t){return e.title.toLowerCase().indexOf(t)>-1})))return!1}if(null!==t.filterButtonsModel.quality&&!_.isEmpty(t.filterButtonsModel.quality)){var i=!1,l=!1;return _.each(t.filterButtonsModel.quality,function(t,n){l=l||t,t&&e.title.toLowerCase().indexOf(n.substring(1))>-1&&(i=!0)}),!l||i}return!0}),s=t.selected;_.forEach(t.selected,function(e){-1===l.indexOf(e)&&(console.log("Removing "+e.title+" from selected results because it's being hidden"),t.$broadcast("toggleSelection",e,!1),s.splice(t.selected.indexOf(e),1))}),t.selected=s;var c=_.groupBy(l,b),u=_.map(c,function(e){var t=_.groupBy(e,"hash"),n=_.map(t,function(e){var t=_.sortBy(e,function(e){var t=i(e);return o?-t:t});return t=_.sortBy(t,function(e){return-1*e.indexerscore})}),a=_.sortBy(n,function(e){return"title"===r?-1*e[0].epoch:i(e[0])});return 2===f.sortMode&&"title"!==r&&(a=a.reverse()),a}),d=_.sortBy(u,function(e){var n;if("grabs"===r&&t.foo.sumGrabs){var a=0;_.each(e,function(e){_.each(e,function(e){a+=i(e)})}),n=a}else n=i(e[0][0]);return n});2===f.sortMode&&(d=d.reverse()),t.lastClickedRowIndex=null;var p=[];return _.forEach(d,function(e){var t=0;_.forEach(e,function(n){var a=0;_.forEach(n,function(r){r.titleGroupIndicator=b(r),r.titleGroupIndex=t,r.duplicateGroupIndex=a,r.duplicatesLength=n.length,r.titlesLength=e.length,p.push(r),a+=1}),t+=1})}),t.$broadcast("calculateDisplayState"),p}function S(){o.reset()}function w(e,n){p=function(e){for(var t={},n=[],a=e.length,r=0,o=0;o<a;o++){var i=e[o];1!==t[i.searchResultId]&&(t[i.searchResultId]=1,n[r++]=i)}return n}(p=n.concat(e.searchResults)),t.filteredResults=v(p),t.numberOfAvailableResults=e.numberOfAvailableResults,t.rejectedReasonsMap=e.rejectedReasonsMap,t.anyResultsRejected=!_.isEmpty(e.rejectedReasonsMap),t.anyIndexersSearchedSuccessfully=_.any(e.indexerSearchMetaDatas,function(e){return e.wasSuccessful}),t.numberOfAcceptedResults=e.numberOfAcceptedResults,t.numberOfRejectedResults=e.numberOfRejectedResults,t.numberOfProcessedResults=e.numberOfProcessedResults,t.numberOfLoadedResults=p.length,t.indexersearches=e.indexerSearchMetaDatas,t.loadMoreEnabled=t.numberOfLoadedResults+t.numberOfRejectedResults<t.numberOfAvailableResults||_.any(e.indexerSearchMetaDatas,function(e){return e.hasMoreResults}),t.totalAvailableUnknown=_.any(e.indexerSearchMetaDatas,function(e){return!e.totalResultsKnown}),!t.foo.indexerStatusesExpanded&&_.any(e.indexerSearchMetaDatas,function(e){return!e.wasSuccessful})&&i.info("Errors occurred during searching, Check indexer statuses"),t.categoriesForFiltering=[];var a=_.uniq(_.pluck(p,"category"));_.forEach(u.getWithoutAll(),function(e){a.indexOf(e.name)>-1&&t.categoriesForFiltering.push({label:e.name,id:e.name})})}t.optionsExtraSettings={showSelectAll:!1,showDeselectAll:!1,buttonText:"Display options"},t.optionsEvents={onToggleItem:function(e,n){var a,r,o,i;console.log(e.id+": "+n),"duplicatesDisplayed"===e.id?(i=n,l.set("duplicatesDisplayed",i),t.$broadcast("duplicatesDisplayed",i),t.foo.duplicatesDisplayed=i):"groupTorrentAndNewznabResults"===e.id?(o=n,l.set("groupTorrentAndNewznabResults",o),t.foo.groupTorrentAndNewznabResults=o,m()):"sumGrabs"===e.id?(r=n,l.set("sumGrabs",r),t.foo.sumGrabs=r,m()):"scrollToResults"===e.id&&(a=n,l.set("scrollToResults",a),t.foo.scrollToResults=a)}},t.indexersForFiltering=[],_.forEach(t.indexersearches,function(e){t.indexersForFiltering.push({label:e.indexerName,id:e.indexerName})}),t.categoriesForFiltering=[],_.forEach(u.getWithoutAll(),function(e){t.categoriesForFiltering.push({label:e.name,id:e.name})}),_.forEach(t.indexersearches,function(e){t.indexerResultsInfo[e.indexerName.toLowerCase()]={loadedResults:e.loaded_results}}),w(s.getLastResults(),[]),t.$emit("searchResultsShown"),s.getLastResults().searchResults&&0!==s.getLastResults().searchResults.length||s.getModalInstance().close(),t.firstResultPredicate=function(e){return e[0][t.sortPredicate]},t.groupId=function(e){return e[0][0].searchResultId},t.onFilterButtonsModelChange=function(){m()},t.$on("sort",function(e,n,r,o){f=0===r?{column:"epoch",sortMode:2,reversed:!0}:{column:n,sortMode:r,reversed:o},a(function(){t.$broadcast("newSortColumn",f.column,f.sortMode,f.reversed)},10),m()}),t.$on("filter",function(e,n,a,r){a.filterValue&&r?t.filterModel[n]=a:delete t.filterModel[n],m()}),t.resort=function(){},t.toggleTitlegroupExpand=function(e){t.groupExpanded[e[0][0].title]=!t.groupExpanded[e[0][0].title],t.groupExpanded[e[0][0].hash]=!t.groupExpanded[e[0][0].hash]},t.stopBlocking=S,t.loadMore=function(e){g(e?"Loading all results...":"Loading more results...").then(function(){var n=e?t.numberOfAvailableResults-t.numberOfProcessedResults:null;s.loadMore(t.numberOfLoadedResults,n,e).then(function(e){w(e,p)})})},t.countResults=function(){return p.length},t.invertSelection=function(){t.$broadcast("invertSelection")},t.deselectAll=function(){t.$broadcast("deselectAll")},t.selectAll=function(){t.$broadcast("selectAll")},t.toggleIndexerStatuses=function(){t.foo.indexerStatusesExpanded=!t.foo.indexerStatusesExpanded,l.set("indexerStatusesExpanded",t.foo.indexerStatusesExpanded)},t.getRejectedReasonsTooltip=function(){if(_.isEmpty(t.rejectedReasonsMap))return"No rejected results";var e="<span >Rejected results:<span><br>";return e+='<table class="rejected-tooltip-table"><thead><tr><th width="50px">Count</th><th>Reason</th></tr></thead>',_.forEach(t.rejectedReasonsMap,function(t,n){e+="<tr><td>"+t+"</td><td>"+n+"</td></tr>"}),e+="</table>"},t.$on("checkboxClicked",function(e,n,a,r,o){n.shiftKey&&null!==t.lastClickedRowIndex&&t.$broadcast("shiftClick",Number(t.lastClickedRowIndex),Number(a),Number(t.lastClickedValue),t.lastClickedElement,o),t.lastClickedRowIndex=a,t.lastClickedElement=o,t.lastClickedValue=r}),t.$on("toggleTitleExpansionUp",function(e,n,a){t.$broadcast("toggleTitleExpansionDown",n,a)}),t.$on("toggleDuplicateExpansionUp",function(e,n,a){t.$broadcast("toggleDuplicateExpansionDown",n,a)}),t.$on("selectionUp",function(e,n,a){var r=t.selected.indexOf(n);a&&-1===r?t.selected.push(n):!a&&r>-1&&t.selected.splice(r,1),t.$broadcast("selectionDown",n,a)}),t.downloadNzbsCallback=function(e){if(null!==e&&e.length>0){i.info("Removing downloaded NZBs from selection");var n=_.filter(t.selected,function(t){return e.indexOf(Number(t.searchResultId))>-1}),a=t.selected;_.forEach(n,function(e){t.$broadcast("toggleSelection",e,!1),a.splice(t.selected.indexOf(e),1)}),t.selected=a}},t.filterRejectedZero=function(){return function(e){return e[1]>0}},t.$on("onFinishRender",function(){t.doShowResults=!0,a(function(){if(t.foo.scrollToResults){var e=angular.element(document.getElementById("display-options"));r.scrollToElement(e,0,500)}S(),s.getModalInstance().close()},1)}),a(function(){d.print()},3e3),a(function(){},100),console.log("end")}function SearchHistoryService(e,t){return{getSearchHistory:function(e,n,a,r,o,i){var l={page:e,limit:n,filterModel:a,distinct:o,onlyCurrentUser:i};angular.isUndefined(e)&&(l.page=1);angular.isUndefined(n)&&(l.limit=100);angular.isUndefined(a)&&(l.filterModel={});angular.isUndefined(r)?l.sortModel={column:"time",sortMode:2}:l.sortModel=r;return t.post("internalapi/history/searches",l).success(function(e){return{searchRequests:e.content,totalRequests:e.totalElements}})},getSearchHistoryForSearching:function(){return t.post("internalapi/history/searches/forsearching").success(function(e){return{searchRequests:e}})},formatRequest:function(t,n,a,r,o){var i=[];i.push('<span class="history-title">Category: </span>'+t.categoryName),a&&t.query&&i.push('<span class="history-title">Query: </span>'+t.query);if(t.title&&o)i.push('<span class="history-title">Title: </span>'+t.title);else if(t.identifiers.length>0){var l,s,c,u=_.indexBy(t.identifiers,"identifierKey");"IMDB"in u?(s="IMDB ID",c=u.IMDB.identifierValue,l="https://www.imdb.com/title/tt"+c):"TVDB"in u?(s="TVDB ID",c=u.TVDB.identifierValue,l="https://thetvdb.com/?tab=series&id="+c):"TVRAGE"in u?(s="TVRage ID",c=u.TVRAGE.identifierValue,l="internalapi/redirect_rid?rid="+c):"TMDB"in u&&(s="TMDB ID",c=u.TMDB.identifierValue,l="https://www.themoviedb.org/movie/"+c),l=e("dereferer")(l),n?i.push('<span class="history-title">'+s+': </span><a target="_blank" href="'+l+'">'+c+"</a>"):i.push('<span class="history-title">'+s+": </span>"+c)}t.season&&i.push('<span class="history-title">Season: </span>'+t.season);t.episode&&i.push('<span class="history-title">Episode: </span>'+t.episode);t.author&&i.push('<span class="history-title">Author: </span>'+t.author);0===i.length&&r&&(i=['<span class="history-title">Empty search</span>']);return i.join(", ")},getStateParamsForRepeatedSearch:function(e){var t={mode:"search"},n=_.pluck(e.identifiers,"identifierKey");n.indexOf("TMDB")>-1||n.indexOf("IMDB")>-1?t.mode="movie":(n.indexOf("TVRAGE")>-1||n.indexOf("TVMAZE")>-1||n.indexOf("TVDB")>-1)&&(t.mode="tvsearch");e.season&&(t.season=e.season);e.episode&&(t.episode=e.episode);_.each(e.identifiers,function(e){switch(e.identifierKey){case"TMDB":t.tmdbid=e.identifierValue;break;case"IMDB":t.imdbid=e.identifierValue;break;case"TVMAZE":t.tvmazeid=e.identifierValue;break;case"TVRAGE":t.tvrageid=e.identifierValue;break;case"TVDB":t.tvdbid=e.identifierValue}}),""!==e.query&&(t.query=e.query);e.title&&(t.title=e.title);e.categoryName&&(t.category=e.categoryName);return t}}}function SearchHistoryController(e,t,n,a,r,o,i,l,s,c){e.limit=100,e.pagination={current:1};var u={column:"time",sortMode:2};l(function(){e.$broadcast("newSortColumn",u.column,u.sortMode)},10),e.filterModel={},e.categoriesForFiltering=[],_.forEach(a.getSafe().categoriesConfig.categories,function(t){e.categoriesForFiltering.push({label:t.name,id:t.name})}),e.preselectedTimeInterval={beforeDate:null,afterDate:null},e.accessOptionsForFiltering=[{label:"All",value:"all"},{label:"API",value:"API"},{label:"Internal",value:"INTERNAL"}],e.searchRequests=r.data.content,e.totalRequests=r.data.totalElements;var d=!1,p=!1;for(var f in e.searchRequests)if(f.username&&(d=!0),f.ip&&(p=!0),p&&d)break;e.columnSizes={time:10,query:30,category:10,additionalParameters:22,source:8,username:10,ip:10},"NONE"===a.getSafe().logging.historyUserInfoType||!d&&!p?(e.columnSizes.username=0,e.columnSizes.ip=0,e.columnSizes.query+=10,e.columnSizes.additionalParameters+=10):"IP"===a.getSafe().logging.historyUserInfoType?(e.columnSizes.username=0,e.columnSizes.query+=5,e.columnSizes.additionalParameters+=5):"USERNAME"===a.getSafe().logging.historyUserInfoType&&(e.columnSizes.ip=0,e.columnSizes.query+=5,e.columnSizes.additionalParameters+=5),e.update=function(){n.getSearchHistory(e.pagination.current,e.limit,e.filterModel,u).then(function(t){e.searchRequests=t.data.content,e.totalRequests=t.data.totalElements})},e.$on("sort",function(t,n,a){u=0===a?{column:"time",sortMode:2}:{column:n,sortMode:a},e.$broadcast("newSortColumn",u.column,u.sortMode),e.update()}),e.$on("filter",function(t,n,a,r){a.filterValue?e.filterModel[n]=a:delete e.filterModel[n],e.update()}),e.openSearch=function(e){t.go("root.search",n.getStateParamsForRepeatedSearch(e),{inherit:!1,notify:!0,reload:!0})},e.formatQuery=function(e){return e.title?e.title:e.query||0!==e.identifiers.length||e.season||e.episode?e.query:"Update query"},e.formatAdditional=function(e){var t=[];if(e.identifiers.length>0){var n,a,r,l=_.find(e.identifiers,function(e){return"TMDB"===e.identifierKey});angular.isDefined(l)&&(a="TMDB ID",n="https://www.themoviedb.org/movie/"+l.identifierValue,n=i("dereferer")(n),r=l.identifierValue),l=_.find(e.identifiers,function(e){return"IMDB"===e.identifierKey}),angular.isDefined(l)&&(a="IMDB ID",n="https://www.imdb.com/title/tt"+l.identifierValue,n=i("dereferer")(n),r=l.identifierValue),l=_.find(e.identifiers,function(e){return"TVDB"===e.identifierKey}),angular.isDefined(l)&&(a="TVDB ID",n="https://thetvdb.com/?tab=series&id="+l.identifierValue,n=i("dereferer")(n),r=l.identifierValue),l=_.find(e.identifiers,function(e){return"TVRAGE"===e.identifierKey}),angular.isDefined(l)&&(a="TVRage ID",n="internalapi/redirectRid/"+l.identifierValue,r=l.identifierValue),t.push(a+': <a target="_blank" href="'+n+'">'+r+"</a>")}return e.season&&t.push("Season: "+e.season),e.episode&&t.push("Episode: "+e.episode),e.author&&t.push("Author: "+e.author),o.trustAsHtml(t.join(", "))},e.showDetails=function(e){function t(e,t,n,a){n.get("internalapi/history/searches/details/"+a).then(function(t){e.details=t.data})}t.$inject=["$scope","$uibModalInstance","$http","searchId"],c.open({templateUrl:"static/html/search-history-details-modal.html",controller:t,size:"md",resolve:{searchId:function(){return e}}})}}function SearchController(e,t,n,a,r,o,i,l,s,c,u,d,p,f,h){function m(e){if(!_.isUndefined(e)&&!_.isNaN(e)&&""!==e)return e=parseInt(e),_.isNumber(e)?e:void 0}var g,y=0,b=!1;e.mode=n.mode,e.query="",e.selectedItem=null,e.categories=_.filter(p.getAllCategories(),function(e){return e.mayBeSelected&&!("INTERNAL"===e.ignoreResultsFrom||"BOTH"===e.ignoreResultsFrom)}),angular.isDefined(n.category)&&n.category?e.category=p.getByName(n.category):e.category=p.getDefault(),e.category=_.isUndefined(n.category)||""===n.category?p.getDefault():p.getByName(n.category),e.season=n.season,e.episode=n.episode,e.query=n.query,e.minsize=m(n.minsize),e.maxsize=m(n.maxsize),e.minage=m(n.minage),e.maxage=m(n.maxage),angular.isDefined(n.indexers)&&(e.indexers=decodeURIComponent(n.indexers).split(",")),angular.isDefined(n.title)&&(angular.isDefined(n.tmdbid)||angular.isDefined(n.imdbid)||angular.isDefined(n.tvmazeid)||angular.isDefined(n.rid)||angular.isDefined(n.tvdbid))&&(e.selectedItem={tmdbId:n.tmdbid,imdbId:n.imdbid,tvmazeId:n.tvmazeid,rid:n.rid,tvdbId:n.tvdbid,title:n.title}),e.showIndexers={},e.searchHistory=[];var v=u.getSafe();function S(){var t=e.selectedIndexers,n=_.pluck(e.availableIndexers,"name");e.selectedIndexers=[];var a=_.chain(v.indexers).filter(function(t){return t.enabled&&t.showOnSearch&&(angular.isUndefined(t.categories)||0===t.categories.length||"all"===e.category.name.toLowerCase()||t.categories.indexOf(e.category.name)>-1)}).sortBy(function(e){return e.name.toLowerCase()}).map(function(t){return{name:t.name,activated:(n=t,angular.isUndefined(e.indexers)?n.preselect:_.contains(e.indexers,n.name)),preselect:t.preselect,categories:t.categories,searchModuleType:t.searchModuleType};var n}).value();return _.forEach(a,function(a){var r=_.indexOf(n,a.name)>-1&&-1===_.indexOf(t,a.name),o=_.indexOf(n,a.name)>-1&&_.indexOf(t,a.name)>-1;(a.activated&&!r||o)&&e.selectedIndexers.push(a.name)}),a}function w(){h.getSearchHistoryForSearching().success(function(t){e.searchHistory=t})}e.showIndexerSelection=d.getUserInfos().showIndexerSelection,e.typeAheadWait=300,e.autocompleteLoading=!1,e.isAskById="TVSEARCH"===e.category.searchType||"MOVIE"===e.category.searchType,e.isById={value:null!==e.selectedItem||angular.isUndefined(e.mode)||null===e.mode},e.availableIndexers=[],e.selectedIndexers=[],e.autocompleteClass="autocompletePosterMovies",e.toggleCategory=function(t){var n=e.category;e.category=t,"TVSEARCH"===e.category.searchType||"MOVIE"===e.category.searchType?(e.isAskById=!0,e.isById.value=!0):(e.isAskById=!1,e.isById.value=!1),n.searchType!==t.searchType&&(e.selectedItem=null),c("searchfield");var a=f.find("#searchfield").controller("ngModel");if(angular.isDefined(a.$viewValue)&&a.$setViewValue(a.$viewValue+" "),v.categoriesConfig.enableCategorySizes){var r=t.minSizePreset,o=t.maxSizePreset;_.isNumber(r)?e.minsize=r:e.minsize="",_.isNumber(o)?e.maxsize=o:e.maxsize=""}e.availableIndexers=S()},e.getAutocomplete=function(n){return e.autocompleteLoading=!0,!e.isById.value||e.selectedItem?{}:"MOVIE"===e.category.searchType?t.get("internalapi/autocomplete/MOVIE/"+n).then(function(t){return e.autocompleteLoading=!1,t.data}):"TVSEARCH"===e.category.searchType?t.get("internalapi/autocomplete/TV/"+n).then(function(t){return e.autocompleteLoading=!1,t.data}):{}},e.onTypeAheadEnter=function(){angular.isDefined(g)?(new Date).getTime()-g>50&&e.initiateSearch():e.initiateSearch()},e.onTypeAheadKeyDown=function(t){8===t.keyCode&&""===e.query&&e.clearAutocomplete()},e.startSearch=function(){b=!1,y=Math.round(999999*Math.random());var t=e.openModal(y),n=angular.isUndefined(e.indexers)?void 0:e.indexers.join(",");s.search(y,e.category.name,e.query,e.selectedItem,e.season,e.episode,e.minsize,e.maxsize,e.minage,e.maxage,n,e.mode).then(function(){s.setModalInstance(t),b||a.go("root.search.results",{minsize:e.minsize,maxsize:e.maxsize,minage:e.minage,maxage:e.maxage},{inherit:!0})},function(){t.close()})},e.openModal=function(e){return r.open({templateUrl:"static/html/search-state.html",controller:SearchUpdateModalInstanceCtrl,size:"md",backdrop:"static",backdropClass:"waiting-cursor",resolve:{searchRequestId:function(){return e},onCancel:function(){return function(){b=!0}}}})},e.goToSearchUrl=function(){var t={};t.mode=e.category.searchType.toLowerCase(),t.imdbid=null===e.selectedItem?null:e.selectedItem.imdbId,t.tmdbid=null===e.selectedItem?null:e.selectedItem.tmdbId,t.tvdbid=null===e.selectedItem?null:e.selectedItem.tvdbId,t.tvrageid=null===e.selectedItem?null:e.selectedItem.tvrageId,t.tvmazeid=null===e.selectedItem?null:e.selectedItem.tvmazeId,t.title=null===e.selectedItem?null:e.selectedItem.title,t.season=e.season,t.episode=e.episode,t.query=e.query,t.minsize=e.minsize,t.maxsize=e.maxsize,t.minage=e.minage,t.maxage=e.maxage,t.category=e.category.name,t.indexers=encodeURIComponent(e.selectedIndexers.join(",")),a.go("root.search",t,{inherit:!1,notify:!0,reload:!0})},e.repeatSearch=function(t){var n=h.getStateParamsForRepeatedSearch(t);n.indexers=encodeURIComponent(e.selectedIndexers.join(",")),a.go("root.search",n,{inherit:!1,notify:!0,reload:!0})},e.searchBoxTooltip="Prefix terms with -- to exclude'",e.$watchGroup(["isAskById","selectedItem"],function(){e.isAskById?null===e.selectedItem?e.searchBoxTooltip="Enter search terms for autocomplete":e.searchBoxTooltip="Enter additional search terms to limit the query":e.searchBoxTooltip="Prefix terms with -- to exclude"}),e.clearAutocomplete=function(){e.selectedItem=null,e.query="",c("searchfield")},e.selectAutocompleteItem=function(t){e.selectedItem=t,e.query="",g=(new Date).getTime()},e.initiateSearch=function(){e.selectedItem,e.goToSearchUrl()},e.autocompleteActive=function(){return e.isAskById},e.seriesSelected=function(){return"TVSEARCH"===e.category.searchType},e.toggleIndexer=function(t){e.availableIndexers[t.name].activated=!e.availableIndexers[t.name].activated},e.formatRequest=function(e){return i.trustAsHtml(h.formatRequest(e,!1,!0,!0,!0))},e.availableIndexers=S(),e.mode?e.startSearch():_.defer(w),e.$on("searchResultsShown",function(){_.defer(w)})}function SearchUpdateModalInstanceCtrl(e,t,n,a,r,o){var i=void 0,l=!1;e.messages=[],e.indexerSelectionFinished=!1,e.indexersSelected=0,e.indexersFinished=0,i=t(function(){n.getSearchState(r).then(function(t){e.indexerSelectionFinished=t.data.indexerSelectionFinished,e.searchFinished=t.data.searchFinished,e.indexersSelected=t.data.indexersSelected,e.indexersFinished=t.data.indexersFinished,e.progressMax=t.data.indexersSelected,e.progressMax>t.data.indexersSelected&&(e.progressMax=">="+t.data.indexersSelected),t.data.messages&&(e.messages=t.data.messages),e.searchFinished&&!l&&(e.messages.push("Finished searching. Preparing results..."),l=!0)},function(){t.cancel(i)})},100),e.cancelSearch=function(){angular.isDefined(i)&&t.cancel(i),o(),a.dismiss()},e.$on("$destroy",function(){angular.isDefined(i)&&t.cancel(i)})}function RestartService(e,t,n){return{restart:function(n){t.restart().then(function(e){a(n,e.data.message)},function(){e.info("Unable to send restart command.")})},startCountdown:a};function a(e,t){n.open({templateUrl:"static/html/restart-modal.html",controller:RestartModalInstanceCtrl,size:"md",backdrop:"static",keyboard:!1,resolve:{message:function(){return e},baseUrl:function(){return t}}})}}function RestartModalInstanceCtrl(e,t,n,a,r,o,i){o=angular.isDefined(o)?o:"",e.message=o+"Will reload page when NZBHydra is back",e.baseUrl=i,e.pingUrl=angular.isDefined(i)?i+"/internalapi/control/ping":"internalapi/control/ping",e.internalCaR=function(o,i){45===i?e.message=o+" Restarting takes longer than expected. You might want to check the log to see what's going on.":(e.message=o+" Will reload page when NZBHydra is back.",t(function(){r.specificallyHandled(function(){n.get(e.pingUrl,{ignoreLoadingBar:!0}).then(function(){t(function(){e.message="Reloading page...",angular.isDefined(e.baseUrl)?a.location.href=e.baseUrl:a.location.reload()},2e3)},function(){e.internalCaR(o,i+1)})})},1e3),e.message=o+" Will reload page when NZBHydra is back.")},t(function(){e.internalCaR(o,0)},3e3)}function NzbHydraControlService(e){return{restart:function(){return e.get("internalapi/control/restart")},shutdown:function(){return e.get("internalapi/control/shutdown")}}}function NzbDownloadService(e,t,n){return{download:function(e,t,r){var o=e.defaultCategory;return r||(_.isUndefined(o)||""===o||null===o)&&"No category"!==o?n.openCategorySelection(e).then(function(n){return a(e,t,n)},function(e){return e}):a(e,t,o)},getEnabledDownloaders:function(){return _.filter(t.getSafe().downloading.downloaders,"enabled")}};function a(t,n,a){var r={downloaderName:t.name,searchResults:n,category:"No category"===a?"":a};return e.put("internalapi/downloader/addNzbs",r)}}function ModalService(e){return{open:function(t,n,a,r,o){angular.isUndefined(o)&&(o="center");e.open({templateUrl:"static/html/modal.html",controller:"ModalInstanceCtrl",size:angular.isDefined(r)?r:"md",resolve:{headline:function(){return t},message:function(){return n},params:function(){return a},textAlign:function(){return o}}}).result.then(function(){},function(){})}}}function ModalInstanceCtrl(e,t,n,a,r,o){e.message=a,e.headline=n,e.params=r,e.showCancel=angular.isDefined(r)&&angular.isDefined(r.cancel),e.showNo=angular.isDefined(r)&&angular.isDefined(r.no),e.textAlign=o,angular.isUndefined(r)||angular.isUndefined(r.yes)?e.params={yes:{text:"Ok"}}:angular.isUndefined(r.yes.text)&&(r.yes.text="Yes"),angular.isDefined(r)&&angular.isDefined(r.no)&&angular.isUndefined(e.params.no.text)&&(e.params.no.text="No"),angular.isDefined(r)&&angular.isDefined(r.cancel)&&angular.isUndefined(e.params.cancel.text)&&(e.params.cancel.text="Cancel"),e.yes=function(){t.close(),angular.isDefined(r)&&angular.isDefined(r.yes)&&angular.isDefined(e.params.yes.onYes)&&e.params.yes.onYes()},e.no=function(){t.close(),angular.isDefined(r)&&angular.isDefined(r.no)&&angular.isDefined(e.params.no.onNo)&&e.params.no.onNo(t)},e.cancel=function(){t.dismiss(),angular.isDefined(r.cancel)&&angular.isDefined(e.params.cancel.onCancel)&&e.params.cancel.onCancel()},e.$on("modal.closing",function(t,n,a){"backdrop click"==n&&e.cancel()})}function GeneralModalService(){this.open=function(e,t,n,a,r){var o=angular.injector(["ng","ui.bootstrap"]).get("$uibModal"),i={};angular.isUndefined(a)&&(i.size=a),angular.isUndefined(t)?angular.isUndefined(n)?i.template='<pre style="margin:0">'+e+"</pre>":i.templateUrl=n:i.template=t,i.resolve={data:function(){return r}},o.open(i).result.then()}}function MigrationService(e){return{migrate:function(){e.open({templateUrl:"static/html/migration-modal.html",controller:"MigrationModalInstanceCtrl",size:"md",backdrop:"static",keyboard:!1}).result.then(function(){ConfigService.reloadConfig()},function(){})}}}function MigrationModalInstanceCtrl(e,t,n,a,r,o){e.baseUrl="http://127.0.0.1:5075",e.foo={isMigrating:!1,baseUrl:e.baseUrl},e.doMigrateDatabase=!0,e.yes=function(){var i,l;e.foo.baseUrl&&e.foo.isFileBasedOpen&&(e.foo.baseUrl=null),e.foo.isUrlBasedOpen?(l="internalapi/migration/url",i={baseurl:e.foo.baseUrl,doMigrateDatabase:e.doMigrateDatabase}):(l="internalapi/migration/files",i={settingsCfgFile:e.foo.settingsCfgFile,dbFile:e.foo.nzbhydraDbFile,doMigrateDatabase:e.doMigrateDatabase}),e.foo.isMigrating=!0;var s=n(function(){a.get("internalapi/migration/messages").then(function(t){e.foo.messages=t.data},function(){n.cancel(s),e.foo.isMigrating=!1})},500);a.get(l,{params:i}).then(function(a){var i;r.stop();var l=a.data;l.requirementsMet?l.configMigrated?l.databaseMigrated?(n.cancel(s),t.dismiss(),e.foo.isMigrating=!1,i="The migration was completed successfully.",l.warningMessages.length>0&&(i+='<br><br><span class="warning">The following warnings resulted from the config migration:<ul style="list-style: none">',_.forEach(l.warningMessages,function(e){i+="<li>"+e+"</li>"}),i+="</ul></span>"),i+="<br><br>NZBHydra needs to restart for the changes to be effective.",o.open("Migration successful",i,{yes:{onYes:function(){RestartService.startCountdown()},text:"Restart"},cancel:{onCancel:function(){},text:"Not now"}})):(n.cancel(s),t.dismiss(),e.foo.isMigrating=!1,i="An error occurred while migrating the database.<br>"+l.error+"<br>. The config was migrated successfully though.",l.messages.length>0&&(i+='<br><br><span class="warning">The following warnings resulted from the config migration:<ul style="list-style: none">',_.forEach(l.messages,function(e){i+="<li>"+e+"</li>"}),i+="</ul></span>"),o.open("Database migration failed",i,{yes:{text:"OK"}})):(n.cancel(s),t.dismiss(),e.foo.isMigrating=!1,o.open("Config migration failed","An error occurred while migrating the config. Migration failed:<br>"+l.error,{yes:{text:"OK"}})):(n.cancel(s),e.foo.isMigrating=!1,o.open("Requirements not met","An error occurred while preparing the migration:<br>"+l.error,{yes:{text:"OK"}}))},function(t){n.cancel(s),e.foo.messages=[t.data.message]}),e.$on("$destroy",function(){angular.isDefined(s)&&n.cancel(s)})},e.cancel=function(){t.dismiss()}}function LoginController(e,t,n,a,r){e.user={},e.login=function(){t.specificallyHandled(function(){a.login(e.user.username,e.user.password).then(function(){a.setLoggedInByForm(),r.info("Login successful!"),n.go("root.search")},function(){r.error("Login failed!")})})}}function IndexerStatusesController(e,t,n){e.statuses=n.data,e.isInPast=function(e){return e<moment().unix()},e.enable=function(n){t.post("internalapi/indexerstatuses/enable/"+encodeURI(n)).then(function(t){e.statuses=t.data})}}function formatDate(e){return function(t,n){if(t){if(1e3*t<(new Date).getTime()&&n)return"";var a=1e3*t;return a=e(a,"yyyy-MM-dd HH:mm")}return""}}function reformatDate(){return function(e,t){return angular.isUndefined(t)&&(t="YYYY-MM-DD HH:mm"),moment.unix(e).local().format(t)}}function reformatDateSeconds(){return function(e,t){return moment.unix(e).local().format("YYYY-MM-DD HH:mm:ss")}}function humanizeDate(){return function(e){return moment().to(moment.unix(e))}}function IndexController(e,t,n,a){a.go("root.search")}function HydraAuthService(e,t,n,a,r,o){a.username;return{isLoggedIn:function(){return a.username},login:function(o,i){var l=e.defer();return n({url:"login",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:r({username:o,password:i})}).then(function(){n.get("internalapi/userinfos").then(function(e){a=e.data,!0,t.$broadcast("user:loggedIn"),l.resolve()})})},askForPassword:function(e){return n.get("internalapi/askpassword",{params:e}).then(function(e){return a=e.data})},logout:function(){var r=e.defer();return n.post("logout").then(function(){n.get("internalapi/userinfos").then(function(e){a=e.data,t.$broadcast("user:loggedOut"),!1,a.maySeeSearch?o.go("root.search"):o.go("root.login"),r.resolve()})})},setLoggedInByForm:function(){t.$broadcast("user:loggedIn")},getUserRights:function(){var e=i();return{maySeeStats:e.maySeeStats,maySeeAdmin:e.maySeeAdmin,maySeeSearch:e.maySeeSearch}},setLoggedInByBasic:function(e,t,n){},getUserName:function(){return a.username},getUserInfos:i};function i(){return a}}function HeaderController(e,t,n,a,t){function r(n){e.userInfos=a.getUserInfos(),e.userInfos.authConfigured?e.userInfos.username?(e.showSearch=!0,e.showAdmin=e.userInfos.maySeeAdmin||!e.userInfos.adminRestricted,e.showStats=e.userInfos.maySeeStats||!e.userInfos.statsRestricted,e.showLoginout=!0,e.username=e.userInfos.username,e.loginlogoutText="Logout "+e.username,e.oldUserName=e.username):(e.showAdmin=!e.userInfos.adminRestricted,e.showStats=!e.userInfos.statsRestricted,e.showSearch=!e.userInfos.searchRestricted,e.loginlogoutText="Login",e.showLoginout=(e.userInfos.adminRestricted||e.userInfos.statsRestricted||e.userInfos.searchRestricted)&&"loggedOut"!==n&&!t.is("root.login"),e.username=""):(e.showSearch=!0,e.showAdmin=!0,e.showStats=!0,e.showLoginout=!1)}e.showLoginout=!1,e.oldUserName=null,r(),e.$on("user:loggedIn",function(e,t){r("loggedIn")}),e.$on("user:loggedOut",function(e,t){r("loggedOut")}),e.loginout=function(){if(a.isLoggedIn())a.logout().then(function(){"BASIC"===e.userInfos.authType?n.info("Logged out. Close your browser to make sure session is closed."):"FORM"===e.userInfos.authType&&n.info("Logged out"),r()});else if("BASIC"===e.userInfos.authType){var o={};e.oldUserName&&(o={old_username:e.oldUserName}),a.askForPassword(o).then(function(){n.info("Login successful!"),e.oldUserName=null,r("loggedIn"),t.go("root.search")})}else"FORM"===e.userInfos.authType?t.go("root.login"):n.info("You shouldn't need to login but here you go!")}}nzbhydraapp.config(["$compileProvider",function(e){e.debugInfoEnabled(!0)}]),nzbhydraapp.config(["$animateProvider",function(e){}]),angular.module("nzbhydraApp").config(["$stateProvider","$urlRouterProvider","$locationProvider","blockUIConfig","$urlMatcherFactoryProvider","localStorageServiceProvider","bootstrapped",function(e,t,n,a,r,o,i){function l(e,t,n,a,r){var o=e.defer(),i=a.getUserInfos();return("search"===r?!i.searchRestricted||i.maySeeSearch:"stats"===r?!i.statsRestricted||i.maySeeStats:"admin"!==r||(!i.adminRestricted||i.maySeeAdmin))||"FORM"!==i.authType?o.resolve():t(function(){n.go("root.login")}),o.promise}a.autoBlock=!1,a.resetOnException=!1,a.autoInjectBodyBlock=!1,r.strictMode(!1),t.otherwise("/"),e.state("root",{url:"",abstract:!0,resolve:{},views:{header:{templateUrl:"static/html/states/header.html",controller:"HeaderController"}}}).state("root.config",{url:"/config",views:{},abstract:!0}).state("root.config.main",{url:"/main",views:{"container@":{templateUrl:"static/html/states/config.html",controller:"ConfigController",controllerAs:"ctrl",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],config:["loginRequired","ConfigService",function(e,t){return t.get()}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 0}],$title:["$stateParams",function(e){return"Config (Main)"}]}}}}).state("root.config.auth",{url:"/auth",views:{"container@":{templateUrl:"static/html/states/config.html",controller:"ConfigController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],config:["loginRequired","ConfigService",function(e,t){return t.get()}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 1}],$title:["$stateParams",function(e){return"Config (Auth)"}]}}}}).state("root.config.searching",{url:"/searching",views:{"container@":{templateUrl:"static/html/states/config.html",controller:"ConfigController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],config:["loginRequired","ConfigService",function(e,t){return t.get()}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 2}],$title:["$stateParams",function(e){return"Config (Searching)"}]}}}}).state("root.config.categories",{url:"/categories",views:{"container@":{templateUrl:"static/html/states/config.html",controller:"ConfigController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],config:["loginRequired","ConfigService",function(e,t){return t.get()}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 3}],$title:["$stateParams",function(e){return"Config (Categories)"}]}}}}).state("root.config.downloading",{url:"/downloading",views:{"container@":{templateUrl:"static/html/states/config.html",controller:"ConfigController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],config:["loginRequired","ConfigService",function(e,t){return t.get()}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 4}],$title:["$stateParams",function(e){return"Config (Downloading)"}]}}}}).state("root.config.indexers",{url:"/indexers",views:{"container@":{templateUrl:"static/html/states/config.html",controller:"ConfigController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],config:["loginRequired","ConfigService",function(e,t){return t.get()}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 5}],$title:["$stateParams",function(e){return"Config (Indexers)"}]}}}}).state("root.stats",{url:"/stats",abstract:!0,views:{"container@":{templateUrl:"static/html/states/stats.html",controller:["$scope","$state",function(e,t){e.$state=t}],resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"stats")}],$title:["$stateParams",function(e){return"Stats"}]}}}}).state("root.stats.main",{url:"/stats",views:{"stats@root.stats":{templateUrl:"static/html/states/main-stats.html",controller:"StatsController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"stats")}],$title:["$stateParams",function(e){return"Stats"}]}}}}).state("root.stats.indexers",{url:"/indexers",views:{"stats@root.stats":{templateUrl:"static/html/states/indexer-statuses.html",controller:IndexerStatusesController,resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"stats")}],statuses:["$http",function(e){return e.get("internalapi/indexerstatuses").success(function(e){return e})}],$title:["$stateParams",function(e){return"Stats (Indexers)"}]}}}}).state("root.stats.searches",{url:"/searches",views:{"stats@root.stats":{templateUrl:"static/html/states/search-history.html",controller:SearchHistoryController,resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"stats")}],history:["loginRequired","SearchHistoryService",function(e,t){return t.getSearchHistory()}],$title:["$stateParams",function(e){return"Stats (Searches)"}]}}}}).state("root.stats.downloads",{url:"/downloads",views:{"stats@root.stats":{templateUrl:"static/html/states/download-history.html",controller:DownloadHistoryController,resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"stats")}],downloads:["StatsService",function(e){return e.getDownloadHistory()}],$title:["$stateParams",function(e){return"Stats (Downloads)"}]}}}}).state("root.system",{url:"/system",views:{},abstract:!0}).state("root.system.control",{url:"/control",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 0}],$title:["$stateParams",function(e){return"System"}]}}}}).state("root.system.updates",{url:"/updates",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 1}],$title:["$stateParams",function(e){return"System (Updates)"}]}}}}).state("root.system.log",{url:"/log",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 2}],$title:["$stateParams",function(e){return"System (Log)"}]}}}}).state("root.system.tasks",{url:"/tasks",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 3}],$title:["$stateParams",function(e){return"System (Tasks)"}]}}}}).state("root.system.backup",{url:"/backup",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 4}],$title:["$stateParams",function(e){return"System (Backup)"}]}}}}).state("root.system.bugreport",{url:"/bugreport",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 5}],$title:["$stateParams",function(e){return"System (Bug report)"}]}}}}).state("root.system.news",{url:"/news",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 6}],$title:["$stateParams",function(e){return"System (News)"}]}}}}).state("root.system.about",{url:"/about",views:{"container@":{templateUrl:"static/html/states/system.html",controller:"SystemController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"admin")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],activeTab:[function(){return 7}],$title:["$stateParams",function(e){return"System (About)"}]}}}}).state("root.search",{url:"/?category&query&imdbid&tvdbid&title&season&episode&minsize&maxsize&minage&maxage&offsets&tvrageid&mode&tmdbid&indexers&tvmazeid",views:{"container@":{templateUrl:"static/html/states/search.html",controller:"SearchController",resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"search")}],safeConfig:["loginRequired","ConfigService",function(e,t){return t.getSafe()}],$title:["$stateParams",function(e){return"Search"}]}}}}).state("root.search.results",{views:{"results@root.search":{templateUrl:"static/html/states/search-results.html",controller:"SearchResultsController",controllerAs:"srController",options:{inherit:!0},params:{modalInstance:null},resolve:{loginRequired:["$q","$timeout","$state","HydraAuthService",function(e,t,n,a){return l(e,t,n,a,"search")}],$title:["$stateParams",function(e){var t,n="Search results";return e.title?t=e.title:e.query&&(t=e.query),t&&(n+=" ("+t+")"),n}]}}}}).state("root.login",{url:"/login",views:{"container@":{templateUrl:"static/html/states/login.html",controller:"LoginController",resolve:{loginRequired:function(){return null},$title:["$stateParams",function(e){return"Login"}]}}}}),n.html5Mode(!0),o.setPrefix("nzbhydra"),o.setNotify(!0,!1)}]),nzbhydraapp.config(["paginationTemplateProvider",function(e){e.setPath("static/html/dirPagination.tpl.html")}]),nzbhydraapp.config(["cfpLoadingBarProvider",function(e){e.latencyThreshold=100}]),nzbhydraapp.config(["growlProvider",function(e){e.globalTimeToLive(5e3),e.globalPosition("bottom-right")}]),nzbhydraapp.directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$evalAsync(n.ngEnter)}),t.preventDefault())})}}),nzbhydraapp.filter("nzblink",function(){return function(e){return new URI("internalapi/getnzb/user/"+e.searchResultId).toString()}}),nzbhydraapp.factory("focus",["$rootScope","$timeout",function(e,t){return function(n){t(function(){e.$broadcast("focusOn",n)})}}]),nzbhydraapp.run(["$rootScope",function(e){e.$on("$stateChangeSuccess",function(t,n,a,r,o){try{e.title=n.views[Object.keys(n.views)[0]].resolve.$title[1](a)}catch(e){}})}]),nzbhydraapp.filter("dereferer",["ConfigService",function(e){return function(t){return e.getSafe().dereferer?e.getSafe().dereferer.replace("$s",escape(t)):t}}]),nzbhydraapp.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","$injector",function(e,t){return function(t,n){e(t,n);try{if(angular.isDefined(t.stack)){var a=t.stack.split("\n").map(function(e){return e.trim()});a=a.join("\n")}}catch(e){console.error("Unable to log JS exception to server",e)}}}])}]),_.mixin({isNullOrEmpty:function(e){return _.isUndefined(e)||_.isNull(e)||_.isString(e)&&0===e.length}}),nzbhydraapp.factory("sessionInjector",["$injector",function(e){return{response:function(t){return null!=t.headers("Hydra-MaySeeAdmin")&&e.get("HydraAuthService").setLoggedInByBasic("True"==t.headers("Hydra-MaySeeStats"),"True"==t.headers("Hydra-MaySeeAdmin"),t.headers("Hydra-Username")),t}}}]),nzbhydraapp.config(["$httpProvider",function(e){e.interceptors.push("sessionInjector")}]),nzbhydraapp.directive("autoFocus",["$timeout",function(e){return{restrict:"AC",link:function(t,n){e(function(){n[0].focus()},0)}}}]),nzbhydraapp.factory("responseObserver",["$q","$window","growl",function(e,t,n){return{responseError:function(t){switch(t.status){case 403:n.info("You are not allowed to visit that section.")}return angular.isDefined(t.config)&&(t.config.alreadyHandled=!0),e.reject(t)}}}]),nzbhydraapp.config(["$httpProvider",function(e){e.interceptors.push("responseObserver")}]),nzbhydraapp.factory("focus",["$timeout","$window",function(e,t){return function(n){e(function(){var e=t.document.getElementById(n);e&&e.focus()})}}]),nzbhydraapp.directive("eventFocus",["focus",function(e){return function(t,n,a){n.on(a.eventFocus,function(){e(a.eventFocusId)}),t.$on("$destroy",function(){n.off(a.eventFocus)})}}]),angular.module("nzbhydraApp").directive("hydraTasks",hydraTasks),angular.module("nzbhydraApp").directive("tabOrChart",tabOrChart),angular.module("nzbhydraApp").directive("sendTorrentToBlackhole",sendTorrentToBlackhole),angular.module("nzbhydraApp").directive("selectionButton",selectionButton),NfoModalInstanceCtrl.$inject=["$scope","$uibModalInstance","nfo"],angular.module("nzbhydraApp").directive("searchResult",searchResult),angular.module("nzbhydraApp").controller("NfoModalInstanceCtrl",NfoModalInstanceCtrl),angular.module("nzbhydraApp").filter("kify",function(){return function(e){return e>1e3?Math.round(e/1e3)+"k":e}}),onFinishRender.$inject=["$timeout"],angular.module("nzbhydraApp").directive("onFinishRender",onFinishRender),angular.module("nzbhydraApp").directive("multiselectDropdown",dropdownMultiselectDirective),angular.module("nzbhydraApp").directive("keepFocus",["$timeout",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,a,r){r.$parsers.unshift(function(t){return e(function(){n[0].focus()}),t})}}}]),angular.module("nzbhydraApp").directive("indexerSelectionButton",indexerSelectionButton),angular.module("nzbhydraApp").directive("indexerInput",indexerInput),angular.module("nzbhydraApp").directive("hydraupdates",hydraupdates),angular.module("nzbhydraApp").directive("hydraNews",hydraNews),LogModalInstanceCtrl.$inject=["$scope","$uibModalInstance","entry"],escapeHtml.$inject=["$sanitize"],angular.module("nzbhydraApp").directive("hydralog",hydralog),angular.module("nzbhydraApp").controller("LogModalInstanceCtrl",LogModalInstanceCtrl),angular.module("nzbhydraApp").filter("formatTimestamp",formatTimestamp),angular.module("nzbhydraApp").filter("escapeHtml",escapeHtml),angular.module("nzbhydraApp").filter("formatClassname",formatClassname),angular.module("nzbhydraApp").directive("focusOn",focusOn),angular.module("nzbhydraApp").directive("downloadNzbzipButton",downloadNzbzipButton),angular.module("nzbhydraApp").directive("downloadNzbsButton",downloadNzbsButton),freetextFilter.$inject=["DebugService"],booleanFilter.$inject=["DebugService"],angular.module("nzbhydraApp").directive("columnFilterWrapper",columnFilterWrapper),angular.module("nzbhydraApp").directive("freetextFilter",freetextFilter),angular.module("nzbhydraApp").directive("checkboxesFilter",checkboxesFilter),angular.module("nzbhydraApp").directive("booleanFilter",booleanFilter),angular.module("nzbhydraApp").directive("timeFilter",timeFilter),angular.module("nzbhydraApp").directive("numberRangeFilter",numberRangeFilter),angular.module("nzbhydraApp").directive("columnSortable",columnSortable),angular.module("nzbhydraApp").directive("connectionTest",connectionTest),clickOutside.$inject=["$document","$parse","$timeout"],angular.module("nzbhydraApp").directive("clickOutside",clickOutside),angular.module("nzbhydraApp").directive("cfgFormEntry",cfgFormEntry),angular.module("nzbhydraApp").directive("hydrabackup",hydrabackup),addableNzbs.$inject=["DebugService"],angular.module("nzbhydraApp").directive("addableNzbs",addableNzbs),addableNzb.$inject=["DebugService"],angular.module("nzbhydraApp").directive("addableNzb",addableNzb),UpdateService.$inject=["$http","growl","blockUI","RestartService","RequestsErrorHandler","$uibModal","$timeout"],UpdateModalInstanceCtrl.$inject=["$scope","$http","$interval","RequestsErrorHandler"],angular.module("nzbhydraApp").factory("UpdateService",UpdateService),angular.module("nzbhydraApp").controller("UpdateModalInstanceCtrl",UpdateModalInstanceCtrl),UpdateFooterController.$inject=["$scope","UpdateService","RequestsErrorHandler","HydraAuthService","$http","$uibModal","ConfigService"],NewsModalInstanceCtrl.$inject=["$scope","$uibModalInstance","news"],WelcomeModalInstanceCtrl.$inject=["$scope","$uibModalInstance","$state","MigrationService"],angular.module("nzbhydraApp").controller("UpdateFooterController",UpdateFooterController),angular.module("nzbhydraApp").controller("NewsModalInstanceCtrl",NewsModalInstanceCtrl),angular.module("nzbhydraApp").controller("WelcomeModalInstanceCtrl",WelcomeModalInstanceCtrl),SystemController.$inject=["$scope","$state","activeTab","$http","growl","RestartService","MigrationService","ConfigService","NzbHydraControlService"],angular.module("nzbhydraApp").controller("SystemController",SystemController),StatsService.$inject=["$http"],angular.module("nzbhydraApp").factory("StatsService",StatsService),StatsController.$inject=["$scope","$filter","StatsService","blockUI","localStorageService","$timeout","$window","ConfigService"],angular.module("nzbhydraApp").controller("StatsController",StatsController),SearchService.$inject=["$http"],angular.module("nzbhydraApp").factory("SearchService",SearchService),SearchResultsController.$inject=["$stateParams","$scope","$q","$timeout","$document","blockUI","growl","localStorageService","SearchService","ConfigService","CategoriesService","DebugService"],angular.module("nzbhydraApp").controller("SearchResultsController",SearchResultsController),SearchHistoryService.$inject=["$filter","$http"],angular.module("nzbhydraApp").factory("SearchHistoryService",SearchHistoryService),SearchHistoryController.$inject=["$scope","$state","SearchHistoryService","ConfigService","history","$sce","$filter","$timeout","$http","$uibModal"],angular.module("nzbhydraApp").controller("SearchHistoryController",SearchHistoryController),SearchController.$inject=["$scope","$http","$stateParams","$state","$uibModal","$timeout","$sce","growl","SearchService","focus","ConfigService","HydraAuthService","CategoriesService","$element","SearchHistoryService"],SearchUpdateModalInstanceCtrl.$inject=["$scope","$interval","SearchService","$uibModalInstance","searchRequestId","onCancel"],angular.module("nzbhydraApp").controller("SearchController",SearchController),angular.module("nzbhydraApp").controller("SearchUpdateModalInstanceCtrl",SearchUpdateModalInstanceCtrl),RestartService.$inject=["growl","NzbHydraControlService","$uibModal"],RestartModalInstanceCtrl.$inject=["$scope","$timeout","$http","$window","RequestsErrorHandler","message","baseUrl"],angular.module("nzbhydraApp").factory("RestartService",RestartService),angular.module("nzbhydraApp").controller("RestartModalInstanceCtrl",RestartModalInstanceCtrl),NzbHydraControlService.$inject=["$http"],angular.module("nzbhydraApp").factory("NzbHydraControlService",NzbHydraControlService),NzbDownloadService.$inject=["$http","ConfigService","DownloaderCategoriesService"],angular.module("nzbhydraApp").factory("NzbDownloadService",NzbDownloadService),ModalService.$inject=["$uibModal"],ModalInstanceCtrl.$inject=["$scope","$uibModalInstance","headline","message","params","textAlign"],angular.module("nzbhydraApp").factory("ModalService",ModalService),angular.module("nzbhydraApp").controller("ModalInstanceCtrl",ModalInstanceCtrl),angular.module("nzbhydraApp").service("GeneralModalService",GeneralModalService),MigrationService.$inject=["$uibModal"],MigrationModalInstanceCtrl.$inject=["$scope","$uibModalInstance","$interval","$http","blockUI","ModalService"],angular.module("nzbhydraApp").factory("MigrationService",MigrationService),angular.module("nzbhydraApp").controller("MigrationModalInstanceCtrl",MigrationModalInstanceCtrl),LoginController.$inject=["$scope","RequestsErrorHandler","$state","HydraAuthService","growl"],angular.module("nzbhydraApp").controller("LoginController",LoginController),IndexerStatusesController.$inject=["$scope","$http","statuses"],formatDate.$inject=["dateFilter"],angular.module("nzbhydraApp").controller("IndexerStatusesController",IndexerStatusesController),angular.module("nzbhydraApp").filter("formatDate",formatDate),angular.module("nzbhydraApp").filter("reformatDate",reformatDate),angular.module("nzbhydraApp").filter("reformatDateSeconds",reformatDateSeconds),angular.module("nzbhydraApp").filter("humanizeDate",humanizeDate),IndexController.$inject=["$scope","$http","$stateParams","$state"],angular.module("nzbhydraApp").controller("IndexController",IndexController),HydraAuthService.$inject=["$q","$rootScope","$http","bootstrapped","$httpParamSerializerJQLike","$state"],angular.module("nzbhydraApp").factory("HydraAuthService",HydraAuthService),HeaderController.$inject=["$scope","$state","growl","HydraAuthService","$state"],angular.module("nzbhydraApp").controller("HeaderController",HeaderController);var HEADER_NAME="NzbHydra2-Handle-Errors-Generically",specificallyHandleInProgress=!1;function ConfigBoxService(e,t,n){return{checkConnection:function(n,a){var r=t.defer();return e.post(n,a).success(function(e){e.successful?r.resolve({checked:!0,message:null,model:e}):r.reject({checked:!0,message:e.message})}).error(function(e){r.reject({checked:!1,message:e.message})}),r.promise},checkCaps:function(e){var a=t.defer();return n.open({templateUrl:"static/html/checker-state.html",controller:CheckCapsModalInstanceCtrl,size:"md",backdrop:"static",backdropClass:"waiting-cursor",resolve:{capsCheckRequest:function(){return e}}}).result.then(function(e){a.resolve(e[0],e[1])},function(e){a.reject(e)}),a.promise}}}function CheckCapsModalInstanceCtrl(e,t,n,a,r,o){var i;e.messages=void 0,n.post("internalapi/indexer/checkCaps",o).success(function(t){e.$close([t,o.indexerConfig]),0===t.length&&r.info("No indexers were checked")}).error(function(){e.$dismiss("Unknown error")}),a(i=t(function(){n.get("internalapi/indexer/checkCapsMessages").then(function(t){var n=t.data,a=[];for(var r in n)if(n.hasOwnProperty(r))for(var i=0;i<n[r].length;i++){var l="";"SINGLE"!==o.checkType&&(l+=r+": "),l+=n[r][i],a.push(l)}e.messages=a})},500),500),e.$on("$destroy",function(){angular.isDefined(i)&&t.cancel(i)})}nzbhydraapp.factory("RequestsErrorHandler",["$q","growl","blockUI","GeneralModalService",function(e,t,n,a){return{specificallyHandled:function(e){specificallyHandleInProgress=!0;try{return e()}finally{specificallyHandleInProgress=!1}},responseError:function(t){if(n.reset(),t&&t.config&&403!==t.status&&t.config.headers&&t.config.headers[HEADER_NAME]&&!t.config.url.contains("logerror")&&!t.config.url.contains("/ping")&&!t.config.alreadyHandled){if(t.data){var r="An error occurred:<br>"+t.data.status+": "+t.data.error;t.data.path&&(r+="<br><br>Path: "+t.data.path),r+="No message available"!==r?"<br><br>Message: "+t.data.message:"<br><br>Exception: "+t.data.exception}else r="An unknown error occurred while communicating with NZBHydra:<br><br>"+JSON.stringify(t);a.open(r)}else t&&t.config&&t.config.headers&&t.config.headers[HEADER_NAME]&&t.config.url.contains("logerror")&&console.log("Not handling connection error while sending exception to server");return e.reject(t)}}}]),nzbhydraapp.config(["$provide","$httpProvider",function(e,t){function n(e){return(e=e||{}).headers=e.headers||{},specificallyHandleInProgress||(e.headers[HEADER_NAME]=!0),e}t.interceptors.push("RequestsErrorHandler"),e.decorator("$http",["$delegate",function(e){function t(t){return function(a,r){return e[t](a,n(r))}}function a(t){return function(a,r,o){return e[t](a,r,n(o))}}var r=function(t){return e(n(t))};return r.get=t("get"),r.delete=t("delete"),r.head=t("head"),r.jsonp=t("jsonp"),r.post=a("post"),r.put=a("put"),function(t){for(var n in e)t.hasOwnProperty(n)||("function"==typeof e[n]?t[n]=function(){return e.apply(e,arguments)}:t[n]=e[n])}(r),r}])}]),ConfigBoxService.$inject=["$http","$q","$uibModal"],CheckCapsModalInstanceCtrl.$inject=["$scope","$interval","$http","$timeout","growl","capsCheckRequest"],hashCode=function(e){return e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0)},angular.module("nzbhydraApp").run(["formlyConfig","formlyValidationMessages",function(e,t){t.addStringMessage("required","This field is required"),e.extras.errorExistsAndShouldBeVisibleExpression="fc.$touched || form.$submitted"}]),angular.module("nzbhydraApp").config(["formlyConfigProvider",function(e){function t(e,t){e.supportedSearchIds=t.supportedSearchIds,e.supportedSearchTypes=t.supportedSearchTypes,e.categoryMapping=t.categoryMapping,e.configComplete=t.configComplete,e.allCapsChecked=t.allCapsChecked,e.enabled=t.enabled}e.extras.removeChromeAutoComplete=!0,e.extras.explicitAsync=!0,e.disableWarnings=window.onProd,e.setWrapper({name:"settingWrapper",templateUrl:"setting-wrapper.html"}),e.setWrapper({name:"fieldset",template:["<fieldset>",'<legend><span class="config-fieldset-legend">{{options.templateOptions.label}}</span></legend>',"<formly-transclude></formly-transclude>","</fieldset>"].join(" ")}),e.setType({name:"help",template:['<div class="panel panel-default" style="margin-top: {{options.templateOptions.marginTop}}; margin-bottom: {{options.templateOptions.marginBottom}} ;">','<div class="panel-body {{options.templateOptions.class}}">','<div ng-repeat="line in options.templateOptions.lines"><h5>{{ line }}</h5></div>',"</div>","</div>"].join(" ")}),e.setWrapper({name:"logicalGroup",template:["<formly-transclude></formly-transclude>"].join(" ")}),e.setType({name:"horizontalInput",extends:"input",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"timeOfDay",extends:"horizontalInput",controller:["$scope",function(e){e.model[e.options.key]=moment.utc(e.model[e.options.key]).toDate()}]}),e.setType({name:"passwordSwitch",extends:"horizontalInput",template:['<div class="input-group">','<input ng-attr-type="{{ hidePassword ? \'password\' : \'text\' }}" class="form-control" ng-model="model[options.key]"/>','<span class="input-group-btn input-group-btn2">','<button class="btn btn-default" type="button" ng-click="hidePassword=!hidePassword"><span class="glyphicon glyphicon-eye-open" ng-class="{\'glyphicon-eye-open\': hidePassword, \'glyphicon-eye-close\': !hidePassword}"></span></button>',"</div>"].join(" "),controller:function(e){e.hidePassword=!0}}),e.setType({name:"horizontalChips",extends:"horizontalInput",template:'<chips ng-model="model[options.key]" class="chips form-control">            <chip-tmpl class="chip-tmp">                <div class="default-chip">                    {{chip}}                    <span class="glyphicon glyphicon-remove remove-chip" remove-chip></span>                </div>            </chip-tmpl>            <input chip-control class="chip-control"></input>        </chips>'}),e.setType({name:"percentInput",template:['<input type="number" class="form-control" placeholder="Percent" ng-model="model[options.key]" ng-pattern="/^[0-9]+(.[0-9]{1,2})?$/" step="0.01" required />'].join(" ")}),e.setType({name:"apiKeyInput",template:['<div class="input-group">','<input type="text" class="form-control" ng-model="model[options.key]"/>','<span class="input-group-btn input-group-btn2">','<button class="btn btn-default" type="button" ng-click="generate()"><span class="glyphicon glyphicon-refresh"></span></button>',"</div>"].join(" "),controller:function(e){e.generate=function(){for(var t="",n="0123456789abcdefghijklmnopqrstuvwxyz",a=24;a>0;--a)t+=n[Math.floor(Math.random()*n.length)];e.model[e.options.key]=t}}}),e.setType({name:"fileInput",extends:"horizontalInput",template:['<div class="input-group">','<input type="text" class="form-control" ng-model="model[options.key]"/>','<span class="input-group-btn input-group-btn2">','<button class="btn btn-default" type="button" ng-click="open()">...</button>',"</div>"].join(" "),controller:function(e,t){e.open=function(){t.open(e.model[e.options.key],e.to.type).then(function(t){e.model[e.options.key]=t})}}}),e.setType({name:"testConnection",templateUrl:"button-test-connection.html"}),e.setType({name:"horizontalTestConnection",extends:"testConnection",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"checkCaps",templateUrl:"button-check-caps.html",controller:function(e,n,a,r){e.message="",e.uniqueId=hashCode(e.model.name)+hashCode(e.model.host);var o="#button-check-caps-"+e.uniqueId,i="#message-check-caps-"+e.uniqueId;function l(){angular.element(o).removeClass("btn-default"),angular.element(o).removeClass("btn-warning"),angular.element(o).removeClass("btn-success"),angular.element(o).addClass("btn-danger")}e.checkCaps=function(){angular.element(o).addClass("glyphicon-refresh-animate"),n.checkCaps({indexerConfig:e.model,checkType:"SINGLE"}).then(function(n){if(n=n[0],t(e.model,n.indexerConfig),n.indexerConfig.supportedSearchIds.length>0){var s="Supports "+n.indexerConfig.supportedSearchIds;angular.element(i).text(s)}n.indexerConfig.allCapsChecked&&n.indexerConfig.configComplete?(angular.element(o).removeClass("btn-default"),angular.element(o).removeClass("btn-danger"),angular.element(o).removeClass("btn-warning"),angular.element(o).addClass("btn-success"),r.info("Successfully tested capabilites of indexer"),e.form.capsChecked=!0):!n.indexerConfig.allCapsChecked&&n.indexerConfig.configComplete?(angular.element(o).removeClass("btn-default"),angular.element(o).removeClass("btn-danger"),angular.element(o).removeClass("btn-success"),angular.element(o).addClass("btn-warning"),a.open("Incomplete caps check","The capabilities of the indexer could not be checked completely. You may use it but it's recommended to repeat the check at another time.<br>Until then some search types or IDs may not be usable.",{},"md","left"),e.form.capsChecked=!0):n.configComplete||(l(),a.open("Error testing capabilities","An error occurred while contacting the indexer. It will not be usable until the caps check has been executed. You can trigger it manually from the indexer config box",{},"md","left"))},function(e){angular.element(i).text(e),l(),a.open("Error testing capabilities","An error occurred while contacting the indexer. It will not be usable until the caps check has been executed. You can trigger it manually from the indexer config box",{},"md","left")}).finally(function(){angular.element(o).removeClass("glyphicon-refresh-animate")})}}}),e.setType({name:"horizontalCheckCaps",extends:"checkCaps",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"horizontalApiKeyInput",extends:"apiKeyInput",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"horizontalPercentInput",extends:"percentInput",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"switch",template:'<div style="text-align:left"><input bs-switch type="checkbox" ng-model="model[options.key]"/></div>'}),e.setType({name:"duoSetting",extends:"input",defaultOptions:{className:"col-md-9",templateOptions:{type:"number",noRow:!0,label:""}}}),e.setType({name:"horizontalSwitch",extends:"switch",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"horizontalSelect",extends:"select",wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"horizontalMultiselect",defaultOptions:{templateOptions:{optionsAttr:"bs-options",ngOptions:"option[to.valueProp] as option in to.options | filter: $select.search"}},template:'<span multiselect-dropdown options="to.options" selected-model="model[options.key]" settings="settings" events="events"></span>',controller:function(e){var t=e.to.settings||[];t.classes=t.classes||[],angular.extend(t.classes,["form-control"]),e.settings=t,e.events={onToggleItem:function(t,n){e.form.$setDirty(!0)}}},wrapper:["settingWrapper","bootstrapHasError"]}),e.setType({name:"label",template:'<label class="control-label">{{to.label}}</label>'}),e.setType({name:"duolabel",extends:"label",defaultOptions:{className:"col-md-2",templateOptions:{label:"-"}}}),e.setType({name:"repeatSection",templateUrl:"repeatSection.html",controller:function(e){e.formOptions={formState:e.formState},e.addNew=function(){e.form.$setDirty(!0),e.model[e.options.key]=e.model[e.options.key]||[];var t=e.model[e.options.key],n=angular.copy(e.options.templateOptions.defaultModel);t.push(n)},e.remove=function(t){e.model[e.options.key].splice(t,1),e.form.$setDirty(!0)},e.copyFields=function(t){return t=angular.copy(t),e.repeatfields=t,t},e.clear=function(t){return _.mapObject(t,function(t,n){if("object"==typeof n)return e.clear(n)})}}}),e.setType({name:"arrayConfig",templateUrl:"arrayConfig.html",controller:function(e,t,n,a){e.formOptions={formState:e.formState},e._showBox=function(n,r,o,i){t.open({templateUrl:"configBox.html",controller:"ConfigBoxInstanceController",size:"lg",resolve:{model:function(){return n},fields:function(){return e.options.data.fieldsFunction(n,r,o,angular.injector(),a)},isInitial:function(){return o},parentModel:function(){return r},data:function(){return e.options.data}}}).result.then(function(t){e.form.$setDirty(!0),angular.isDefined(i)&&i(!0,t)},function(){angular.isDefined(i)&&i(!1)})},e.showBox=function(t,n){e._showBox(t,n,!1)},e.isInitial=!1,e.presets=e.options.data.presets(e.model),e.addEntry=function(t,a){if(e.options.data.checkAddingAllowed(t,a)){var r=angular.copy(e.options.data.defaultModel);angular.isDefined(a)&&_.extend(r,a),e.isInitial=!0,e._showBox(r,t,!0,function(e,n){e&&t.push(angular.isDefined(n)?n:r)})}else n.error("That predefined indexer is already configured.")}}}),e.setType({name:"recheckAllCaps",templateUrl:"recheckAllCaps.html",controller:function(e,n,a,r){e.recheck=function(n){r.checkCaps({checkType:n}).then(function(n){for(var a=0;a<e.model.length;a++)for(var r=0;r<n.length;r++)e.model[a].name===n[r].indexerConfig.name&&(t(e.model[a],n[r].indexerConfig),e.form.$setDirty(!0))})}}})}]),angular.module("nzbhydraApp").controller("ConfigBoxInstanceController",["$scope","$q","$uibModalInstance","$http","model","fields","isInitial","parentModel","data","growl",function(e,t,n,a,r,o,i,l,s,c){e.model=r,e.fields=o,e.isInitial=i,e.allowDelete=s.allowDeleteFunction(r),e.spinnerActive=!1,e.needsConnectionTest=!1,e.obSubmit=function(){if(e.form.$valid)s.checkBeforeClose(e,r).then(function(t){angular.isDefined(t)&&(e.model=t),n.close(t)});else c.error("Config invalid. Please check your settings."),angular.forEach(e.form.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})})},e.cancel=function(){n.dismiss()},e.deleteEntry=function(){l.splice(l.indexOf(r),1),n.close(e)},e.reset=function(){angular.isDefined(s.resetFunction)&&s.resetFunction(e)},e.$on("modal.closing",function(t,n){"backdrop click"===n&&e.reset(e)})}]),angular.module("nzbhydraApp").factory("ConfigBoxService",ConfigBoxService),angular.module("nzbhydraApp").controller("CheckCapsModalInstanceCtrl",CheckCapsModalInstanceCtrl);var filters=angular.module("filters",[]);function FileSelectionService(e,t,n){var a;return{open:function(r,o){return n.open({templateUrl:"static/html/file-selection.html",controller:"FileSelectionModalController",size:"md",resolve:{data:function(){return e.post("internalapi/config/folderlisting",{fullPath:angular.isDefined(r)?r:null,goUp:!1,type:o})},type:function(){return o}}}).result.then(function(e){a.resolve(e)},function(){a.reject("dismissed")}),(a=t.defer()).promise}}}function FileDownloadService(e,t){return{downloadFile:function(n,a,r,o){return e({method:r,url:n,data:o,responseType:"arraybuffer"}).success(function(e,t,n,r){var o=document.createElement("a"),i=new Blob([e],{type:"application/octet-stream"});o.href=URL.createObjectURL(i),o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o)}).error(function(e,n,a,r){t.error(n)})}}}function DownloaderCategoriesService(e,t,n){var a,r={};return{get:o,invalidate:function(){r={}},select:function(e){e,a.resolve(e)},openCategorySelection:function(e){return n.open({templateUrl:"static/html/directives/addable-nzb-modal.html",controller:"DownloaderCategorySelectionController",size:"sm",resolve:{categories:function(){return o(e)}}}).result.then(function(){},function(){a.reject("dismissed")}),(a=t.defer()).promise}};function o(n){return function(){if(n.name in r){var a=t.defer();return a.resolve(r[n.name]),a.promise}return e.get(encodeURI("internalapi/downloader/"+n.name+"/categories")).then(function(e){return r[n.name]=e.data,e.data},function(e){throw e})}().then(function(e){return e},function(e){throw e})}}function DownloadHistoryController(e,t,n,a,r,o){e.limit=100,e.pagination={current:1};var i={column:"time",sortMode:2};r(function(){e.$broadcast("newSortColumn",i.column,i.sortMode)},10),e.filterModel={},e.indexersForFiltering=[],_.forEach(a.getSafe().indexers,function(t){e.indexersForFiltering.push({label:t.name,id:t.name})}),e.preselectedTimeInterval={beforeDate:null,afterDate:null},e.statusesForFiltering=[{label:"None",id:"NONE"},{label:"Requested",id:"REQUESTED"},{label:"Internal error",id:"INTERNAL_ERROR"},{label:"NZB downloaded successful",id:"NZB_DOWNLOAD_SUCCESSFUL"},{label:"NZB download error",id:"NZB_DOWNLOAD_ERROR"},{label:"NZB added",id:"NZB_ADDED"},{label:"NZB not added",id:"NZB_NOT_ADDED"},{label:"NZB add error",id:"NZB_ADD_ERROR"},{label:"NZB add rejected",id:"NZB_ADD_REJECTED"},{label:"Content download successful",id:"CONTENT_DOWNLOAD_SUCCESSFUL"},{label:"Content download warning",id:"CONTENT_DOWNLOAD_WARNING"},{label:"Content download error",id:"CONTENT_DOWNLOAD_ERROR"}],e.accessOptionsForFiltering=[{label:"All",value:"all"},{label:"API",value:"API"},{label:"Internal",value:"INTERNAL"}],e.nzbDownloads=n.data.content,e.totalDownloads=n.data.totalElements,e.columnSizes={time:10,indexer:10,title:37,result:9,source:8,age:6,username:10,ip:10};var l=!1,s=!1;for(var c in e.nzbDownloads)if(c.username&&(l=!0),c.ip&&(s=!0),s&&l)break;"NONE"===a.getSafe().logging.historyUserInfoType||!l&&!s?(e.columnSizes.username=0,e.columnSizes.ip=0,e.columnSizes.title+=20):"IP"===a.getSafe().logging.historyUserInfoType?(e.columnSizes.username=0,e.columnSizes.title+=10):"USERNAME"===a.getSafe().logging.historyUserInfoType&&(e.columnSizes.ip=0,e.columnSizes.title+=10),e.update=function(){t.getDownloadHistory(e.pagination.current,e.limit,e.filterModel,i).then(function(t){e.nzbDownloads=t.data.content,e.totalDownloads=t.data.totalElements})},e.$on("sort",function(t,n,a){0===a&&(n="time",a=2),i={column:n,sortMode:a},e.$broadcast("newSortColumn",i.column,i.sortMode),e.update()}),e.getStatusIcon=function(e){var t;return"NONE"!==e&&"REQUESTED"!==e||(t='<span class="glyphicon glyphicon-question-sign"></span>'),"INTERNAL_ERROR"===e&&(t='<span class="glyphicon glyphicon-remove"></span>'),"INTERNAL_ERROR"===e&&(t='<span class="glyphicon glyphicon-remove"></span>'),"NZB_DOWNLOAD_SUCCESSFUL"===e&&(t='<span class="glyphicon glyphicon-ok"></span>'),"NZB_DOWNLOAD_ERROR"===e&&(t='<span class="glyphicon glyphicon-remove"></span>'),"NZB_ADDED"===e&&(t='<span class="glyphicon glyphicon-ok" style="margin-right: 3px"></span><span class="glyphicon glyphicon-question-sign"></span>'),"NZB_NOT_ADDED"!==e&&"NZB_ADD_ERROR"!==e&&"NZB_ADD_REJECTED"!==e||(t='<span class="glyphicon glyphicon-ok" style="margin-right: 3px"></span><span class="glyphicon glyphicon-remove"></span>'),"CONTENT_DOWNLOAD_SUCCESSFUL"===e&&(t='<span class="glyphicon glyphicon-ok" style="margin-right: 3px"><span class="glyphicon glyphicon-ok"></span><span class="glyphicon glyphicon-ok"></span>'),"CONTENT_DOWNLOAD_ERROR"!==e&&"CONTENT_DOWNLOAD_WARNING"!==e||(t='<span class="glyphicon glyphicon-ok" style="margin-right: 3px"><span class="glyphicon glyphicon-ok"></span><span class="glyphicon glyphicon-remove"></span>'),o.trustAsHtml('<span tooltip-placement="auto top" uib-tooltip="'+e+'">'+t+"</span>")},e.$on("filter",function(t,n,a,r){a.filterValue?e.filterModel[n]=a:delete e.filterModel[n],e.update()})}function reformatDateEpoch(){return function(e){return moment.unix(e).local().format("YYYY-MM-DD HH:mm")}}function DebugService(e){var t={};return{log:function(e){e in t?t[e].last=(new Date).getTime():t[e]={first:(new Date).getTime(),last:(new Date).getTime()}},print:function(){return}}}function ConfigService(e,t,n,a){var r=n("nzbhydra"),o=a.safeConfig;return{set:function(n,a){var o=t.defer();return e.put("internalapi/config",n).then(function(e){e.data.ok&&(a||0===e.data.warningMessages.length)&&(r.put("config",n),i()),o.resolve(e)},function(e){console.log("Error saving settings:"),console.log(e),o.reject(e)}),o.promise},get:function(){var t=r.get("config");angular.isUndefined(t)&&(t=e.get("internalapi/config").then(function(e){return e.data}),r.put("config",t));return t},getSafe:function(){return o},invalidateSafe:i,maySeeAdminArea:function(){return function(){var n=r.get("maySeeAdminArea");if(!angular.isUndefined(n)){var a=t.defer();return a.resolve(n),a.promise}return e.get("internalapi/mayseeadminarea").then(function(e){var t=e.data;return r.put("maySeeAdminArea",t),e.data})}().then(function(e){return e})},reloadConfig:function(){return e.get("internalapi/config/reload").then(function(e){return e.data})}};function i(){e.get("internalapi/config/safe").then(function(e){o=e.data})}}function ConfigFields(e){return{getFields:function(n){return{main:[{wrapper:"fieldset",templateOptions:{label:"Hosting"},fieldGroup:[{key:"host",type:"horizontalInput",templateOptions:{type:"text",label:"Host",required:!0,placeholder:"IPv4 address to bind to",help:'I strongly recommend <a href="https://github.com/theotherp/nzbhydra2/wiki/Exposing-Hydra-to-the-internet-and-using-reverse-proxies" target="_blank">using a reverse proxy</a> instead of exposing this directly. Requires restart.'},validators:{ipAddress:{expression:function(e,t){var n=t||e;return!n||(/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/.test(n)||/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/.test(n))},message:'$viewValue + " is not a valid IP Address"'}}},{key:"port",type:"horizontalInput",templateOptions:{type:"number",label:"Port",required:!0,placeholder:"5056",help:"Requires restart"},validators:{port:t(/^\d{1,5}$/,"is no valid port",!0)}},{key:"urlBase",type:"horizontalInput",templateOptions:{type:"text",label:"URL base",placeholder:"/nzbhydra",help:'Adapt when using a reverse proxy. See <a href="https://github.com/theotherp/nzbhydra2/wiki/Exposing-Hydra-to-the-internet-and-using-reverse-proxies" target="_blank">wiki</a>. Always use when calling Hydra, even locally.'}},{key:"ssl",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Use SSL",help:"Requires restart."}},{key:"sslKeyStore",hideExpression:"!model.ssl",type:"fileInput",templateOptions:{label:"SSL keystore file",required:!0,type:"file",help:'Requires restart. See <a href="https://github.com/theotherp/nzbhydra2/wiki/SSL" target="_blank">wiki</a>'}},{key:"sslKeyStorePassword",hideExpression:"!model.ssl",type:"horizontalInput",templateOptions:{type:"password",label:"SSL keystore password",required:!0,help:"Requires restart."}},{wrapper:"fieldset",templateOptions:{label:"Proxy"},fieldGroup:[{key:"proxyType",type:"horizontalSelect",templateOptions:{type:"select",label:"Use proxy",options:[{name:"None",value:"NONE"},{name:"SOCKS",value:"SOCKS"},{name:"HTTP(S)",value:"HTTP"}]}},{key:"proxyHost",type:"horizontalInput",hideExpression:'model.proxyType==="NONE"',templateOptions:{type:"text",label:"SOCKS proxy host",placeholder:"Set to use a SOCKS proxy",help:"IPv4 only"}},{key:"proxyPort",type:"horizontalInput",hideExpression:'model.proxyType==="NONE"',templateOptions:{type:"number",label:"Proxy port",placeholder:"1080"}},{key:"proxyUsername",type:"horizontalInput",hideExpression:'model.proxyType==="NONE"',templateOptions:{type:"text",label:"Proxy username"}},{key:"proxyPassword",type:"passwordSwitch",hideExpression:'model.proxyType==="NONE"',templateOptions:{type:"text",label:"Proxy password"}},{key:"proxyIgnoreLocal",type:"horizontalSwitch",hideExpression:'model.proxyType==="NONE"',templateOptions:{type:"switch",label:"Bypass local addresses"}},{key:"proxyIgnoreDomains",type:"horizontalInput",hideExpression:'model.proxyType==="NONE"',templateOptions:{type:"text",help:"Separate by comma. You can use wildcards (*). Case insensitive",label:"Bypass domains"}}]}]},{wrapper:"fieldset",templateOptions:{label:"UI"},fieldGroup:[{key:"theme",type:"horizontalSelect",templateOptions:{type:"select",label:"Theme",help:"Reload page after restart",options:[{name:"Grey",value:"grey"},{name:"Bright",value:"bright"},{name:"Dark",value:"dark"}]}}]},{wrapper:"fieldset",templateOptions:{label:"Security"},fieldGroup:[{key:"apiKey",type:"horizontalApiKeyInput",templateOptions:{label:"API key",help:"Alphanumeric only",required:!0},validators:{apiKey:t(/^[a-zA-Z0-9]*$/,"API key must only contain numbers and digits",!1)}},{key:"dereferer",type:"horizontalInput",templateOptions:{type:"text",label:"Dereferer",help:"Redirect external links to hide your instance. Insert $s for target URL."}},{key:"verifySsl",type:"horizontalSwitch",templateOptions:{label:"Verify SSL certificates",help:'If enabled only valid/known SSL certificates will be accepted when accessing indexers. Change requires restart. See <a href="https://github.com/theotherp/nzbhydra2/wiki/SSL-verification-errors" target="_blank">wiki</a>'}},{key:"sniDisabledFor",type:"horizontalChips",templateOptions:{type:"text",label:"Disable SNI",help:'Add a host if you get an "unrecognized_name" error. Apply words with return key. See <a href="https://github.com/theotherp/nzbhydra2/wiki/SSL-verification-errors" target="_blank">wiki</a>'}},{key:"useCsrf",type:"horizontalSwitch",templateOptions:{label:"Use CSRF protection",help:'Use <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank">CSRF protection</a>'}}]},{wrapper:"fieldset",key:"logging",templateOptions:{label:"Logging"},fieldGroup:[{key:"logfilelevel",type:"horizontalSelect",templateOptions:{type:"select",label:"Logfile level",options:[{name:"Error",value:"ERROR"},{name:"Warning",value:"WARN"},{name:"Info",value:"INFO"},{name:"Debug",value:"DEBUG"}]}},{key:"logMaxHistory",type:"horizontalInput",templateOptions:{type:"number",label:"Max log history",help:"How many daily log files will be kept"}},{key:"consolelevel",type:"horizontalSelect",templateOptions:{type:"select",label:"Console log level",options:[{name:"Error",value:"ERROR"},{name:"Warning",value:"WARN"},{name:"Info",value:"INFO"},{name:"Debug",value:"DEBUG"}]}},{key:"logIpAddresses",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Log IP addresses"}},{key:"logUsername",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Log user names"}},{key:"historyUserInfoType",type:"horizontalSelect",templateOptions:{type:"select",label:"History user info",options:[{name:"IP and username",value:"BOTH"},{name:"IP address",value:"IP"},{name:"Username",value:"USERNAME"},{name:"None",value:"NONE"}],help:"Only affects if value is displayed in the search/download history"}},{key:"markersToLog",type:"horizontalMultiselect",templateOptions:{label:"Log markers",help:"Select certain sections for more output on debug level",options:[{label:"Removed trailing words",id:"TRAILING"},{label:"Rejected results",id:"RESULT_ACCEPTOR"},{label:"Performance",id:"PERFORMANCE"},{label:"Duplicate detection",id:"DUPLICATES"},{label:"Indexer scheduler",id:"SCHEDULER"},{label:"User agent mapping",id:"USER_AGENT"},{label:"Download status updating",id:"DOWNLOAD_STATUS_UPDATE"},{label:"URL calculation",id:"URL_CALCULATION"}],hideExpression:'model.consolelevel !== "DEBUG" && model.logfilelevel !== "DEBUG"',buttonText:"None"}}]},{wrapper:"fieldset",templateOptions:{label:"Other"},fieldGroup:[{key:"startupBrowser",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Open browser on startup"}},{key:"backupEverySunday",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Backup every sunday"}},{key:"backupBeforeUpdate",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Backup before update"}},{key:"showNews",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Show news",help:"Hydra will occasionally show news when opened. You can always find them in the system section"}},{key:"xmx",type:"horizontalInput",templateOptions:{type:"number",label:"JVM memory",addonRight:{text:"MB"},help:'128M should suffice except when working with big databases / many indexers. See <a href="https://github.com/theotherp/nzbhydra2/wiki/Memory-requirements" target="_blank">wiki</a>'}}]}],searching:[{wrapper:"fieldset",templateOptions:{label:"Indexer access"},fieldGroup:[{key:"timeout",type:"horizontalInput",templateOptions:{type:"number",label:"Timeout when accessing indexers",help:"Any web call to an indexer taking longer than this is aborted",addonRight:{text:"seconds"}}},{key:"ignoreTemporarilyDisabled",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Ignore temporarily disabled",help:"If enabled access to indexers will never be paused after an error occurred"}},{key:"generateQueries",type:"horizontalSelect",templateOptions:{label:"Generate queries",options:[{name:"Internal searches",value:"INTERNAL"},{name:"API searches",value:"API"},{name:"All searches",value:"BOTH"},{name:"Never",value:"NONE"}],help:"Generate queries for indexers which do not support ID based searches"}},{key:"idFallbackToQueryGeneration",type:"horizontalSelect",templateOptions:{label:"Fallback to generated queries",options:[{name:"Internal searches",value:"INTERNAL"},{name:"API searches",value:"API"},{name:"All searches",value:"BOTH"},{name:"Never",value:"NONE"}],help:"When no results were found for a query ID search again using a generated query (on indexer level)"}},{key:"language",type:"horizontalSelect",templateOptions:{type:"text",label:"Language",required:!0,help:"Used for movie query generation and autocomplete only.",options:[{name:"Abkhaz",value:"ab"},{name:"Afar",value:"aa"},{name:"Afrikaans",value:"af"},{name:"Akan",value:"ak"},{name:"Albanian",value:"sq"},{name:"Amharic",value:"am"},{name:"Arabic",value:"ar"},{name:"Aragonese",value:"an"},{name:"Armenian",value:"hy"},{name:"Assamese",value:"as"},{name:"Avaric",value:"av"},{name:"Avestan",value:"ae"},{name:"Aymara",value:"ay"},{name:"Azerbaijani",value:"az"},{name:"Bambara",value:"bm"},{name:"Bashkir",value:"ba"},{name:"Basque",value:"eu"},{name:"Belarusian",value:"be"},{name:"Bengali",value:"bn"},{name:"Bihari",value:"bh"},{name:"Bislama",value:"bi"},{name:"Bosnian",value:"bs"},{name:"Breton",value:"br"},{name:"Bulgarian",value:"bg"},{name:"Burmese",value:"my"},{name:"Catalan",value:"ca"},{name:"Chamorro",value:"ch"},{name:"Chechen",value:"ce"},{name:"Chichewa",value:"ny"},{name:"Chinese",value:"zh"},{name:"Chuvash",value:"cv"},{name:"Cornish",value:"kw"},{name:"Corsican",value:"co"},{name:"Cree",value:"cr"},{name:"Croatian",value:"hr"},{name:"Czech",value:"cs"},{name:"Danish",value:"da"},{name:"Divehi",value:"dv"},{name:"Dutch",value:"nl"},{name:"Dzongkha",value:"dz"},{name:"English",value:"en"},{name:"Esperanto",value:"eo"},{name:"Estonian",value:"et"},{name:"Ewe",value:"ee"},{name:"Faroese",value:"fo"},{name:"Fijian",value:"fj"},{name:"Finnish",value:"fi"},{name:"French",value:"fr"},{name:"Fula",value:"ff"},{name:"Galician",value:"gl"},{name:"Georgian",value:"ka"},{name:"German",value:"de"},{name:"Greek",value:"el"},{name:"Guaran",value:"gn"},{name:"Gujarati",value:"gu"},{name:"Haitian",value:"ht"},{name:"Hausa",value:"ha"},{name:"Hebrew",value:"he"},{name:"Herero",value:"hz"},{name:"Hindi",value:"hi"},{name:"Hiri Motu",value:"ho"},{name:"Hungarian",value:"hu"},{name:"Interlingua",value:"ia"},{name:"Indonesian",value:"id"},{name:"Interlingue",value:"ie"},{name:"Irish",value:"ga"},{name:"Igbo",value:"ig"},{name:"Inupiaq",value:"ik"},{name:"Ido",value:"io"},{name:"Icelandic",value:"is"},{name:"Italian",value:"it"},{name:"Inuktitut",value:"iu"},{name:"Japanese",value:"ja"},{name:"Javanese",value:"jv"},{name:"Kalaallisut",value:"kl"},{name:"Kannada",value:"kn"},{name:"Kanuri",value:"kr"},{name:"Kashmiri",value:"ks"},{name:"Kazakh",value:"kk"},{name:"Khmer",value:"km"},{name:"Kikuyu",value:"ki"},{name:"Kinyarwanda",value:"rw"},{name:"Kyrgyz",value:"ky"},{name:"Komi",value:"kv"},{name:"Kongo",value:"kg"},{name:"Korean",value:"ko"},{name:"Kurdish",value:"ku"},{name:"Kwanyama",value:"kj"},{name:"Latin",value:"la"},{name:"Luxembourgish",value:"lb"},{name:"Ganda",value:"lg"},{name:"Limburgish",value:"li"},{name:"Lingala",value:"ln"},{name:"Lao",value:"lo"},{name:"Lithuanian",value:"lt"},{name:"Luba-Katanga",value:"lu"},{name:"Latvian",value:"lv"},{name:"Manx",value:"gv"},{name:"Macedonian",value:"mk"},{name:"Malagasy",value:"mg"},{name:"Malay",value:"ms"},{name:"Malayalam",value:"ml"},{name:"Maltese",value:"mt"},{name:"Mori",value:"mi"},{name:"Marathi",value:"mr"},{name:"Marshallese",value:"mh"},{name:"Mongolian",value:"mn"},{name:"Nauru",value:"na"},{name:"Navajo",value:"nv"},{name:"Northern Ndebele",value:"nd"},{name:"Nepali",value:"ne"},{name:"Ndonga",value:"ng"},{name:"Norwegian Bokml",value:"nb"},{name:"Norwegian Nynorsk",value:"nn"},{name:"Norwegian",value:"no"},{name:"Nuosu",value:"ii"},{name:"Southern Ndebele",value:"nr"},{name:"Occitan",value:"oc"},{name:"Ojibwe",value:"oj"},{name:"Old Church Slavonic",value:"cu"},{name:"Oromo",value:"om"},{name:"Oriya",value:"or"},{name:"Ossetian",value:"os"},{name:"Panjabi",value:"pa"},{name:"Pli",value:"pi"},{name:"Persian",value:"fa"},{name:"Polish",value:"pl"},{name:"Pashto",value:"ps"},{name:"Portuguese",value:"pt"},{name:"Quechua",value:"qu"},{name:"Romansh",value:"rm"},{name:"Kirundi",value:"rn"},{name:"Romanian",value:"ro"},{name:"Russian",value:"ru"},{name:"Sanskrit",value:"sa"},{name:"Sardinian",value:"sc"},{name:"Sindhi",value:"sd"},{name:"Northern Sami",value:"se"},{name:"Samoan",value:"sm"},{name:"Sango",value:"sg"},{name:"Serbian",value:"sr"},{name:"Gaelic",value:"gd"},{name:"Shona",value:"sn"},{name:"Sinhala",value:"si"},{name:"Slovak",value:"sk"},{name:"Slovene",value:"sl"},{name:"Somali",value:"so"},{name:"Southern Sotho",value:"st"},{name:"Spanish",value:"es"},{name:"Sundanese",value:"su"},{name:"Swahili",value:"sw"},{name:"Swati",value:"ss"},{name:"Swedish",value:"sv"},{name:"Tamil",value:"ta"},{name:"Telugu",value:"te"},{name:"Tajik",value:"tg"},{name:"Thai",value:"th"},{name:"Tigrinya",value:"ti"},{name:"Tibetan Standard",value:"bo"},{name:"Turkmen",value:"tk"},{name:"Tagalog",value:"tl"},{name:"Tswana",value:"tn"},{name:"Tonga",value:"to"},{name:"Turkish",value:"tr"},{name:"Tsonga",value:"ts"},{name:"Tatar",value:"tt"},{name:"Twi",value:"tw"},{name:"Tahitian",value:"ty"},{name:"Uyghur",value:"ug"},{name:"Ukrainian",value:"uk"},{name:"Urdu",value:"ur"},{name:"Uzbek",value:"uz"},{name:"Venda",value:"ve"},{name:"Vietnamese",value:"vi"},{name:"Volapk",value:"vo"},{name:"Walloon",value:"wa"},{name:"Welsh",value:"cy"},{name:"Wolof",value:"wo"},{name:"Western Frisian",value:"fy"},{name:"Xhosa",value:"xh"},{name:"Yiddish",value:"yi"},{name:"Yoruba",value:"yo"},{name:"Zhuang",value:"za"},{name:"Zulu",value:"zu"}]}},{key:"userAgent",type:"horizontalInput",templateOptions:{type:"text",label:"User agent",help:"Used when accessing indexers",required:!0}},{key:"userAgents",type:"horizontalChips",templateOptions:{type:"text",label:"Map user agents",help:"Used to map the user agent from accessing services to the service names. Apply words with return key."}}]},{wrapper:"fieldset",templateOptions:{label:"Result filters"},fieldGroup:[{key:"applyRestrictions",type:"horizontalSelect",templateOptions:{label:"Apply word filters",options:[{name:"All searches",value:"BOTH"},{name:"Internal searches",value:"INTERNAL"},{name:"API searches",value:"API"},{name:"Never",value:"NONE"}],help:"For which type of search word/regex filters will be applied"}},{key:"forbiddenWords",type:"horizontalChips",templateOptions:{type:"text",label:"Forbidden words",help:"Results with any of these words in the title will be ignored. Title is converted to lowercase before. Apply words with return key."},hideExpression:function(){return"NONE"===n.searching.applyRestrictions}},{key:"forbiddenRegex",type:"horizontalInput",templateOptions:{type:"text",label:"Forbidden regex",help:"Must not be present in a title (case is ignored)"},hideExpression:function(){return"NONE"===n.searching.applyRestrictions}},{key:"requiredWords",type:"horizontalChips",templateOptions:{type:"text",label:"Required words",help:"Only results with titles that contain *all* words will be used. Title is converted to lowercase before. Apply words with return key."},hideExpression:function(){return"NONE"===n.searching.applyRestrictions}},{key:"requiredRegex",type:"horizontalInput",templateOptions:{type:"text",label:"Required regex",help:"Must be present in a title (case is ignored)"},hideExpression:function(){return"NONE"===n.searching.applyRestrictions}},{key:"forbiddenGroups",type:"horizontalChips",templateOptions:{type:"text",label:"Forbidden groups",help:"Posts from any groups containing any of these words will be ignored. Apply words with return key."},hideExpression:function(){return"NONE"===n.searching.applyRestrictions}},{key:"forbiddenPosters",type:"horizontalChips",templateOptions:{type:"text",label:"Forbidden posters",help:"Posts from any posters containing any of these words will be ignored. Apply words with return key."}},{key:"maxAge",type:"horizontalInput",templateOptions:{type:"number",label:"Maximum results age",help:"Results older than this are ignored. Can be overwritten per search. Apply words with return key.",addonRight:{text:"days"}}},{key:"ignorePassworded",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Ignore passworded releases",help:"Not all indexers provide this information"}}]},{wrapper:"fieldset",templateOptions:{label:"Result processing"},fieldGroup:[{key:"wrapApiErrors",type:"horizontalSwitch",templateOptions:{type:"text",label:"Wrap API errors in empty results page",help:"When enabled accessing tools will think the search was completed successfully but without results"}},{key:"duplicateSizeThresholdInPercent",type:"horizontalPercentInput",templateOptions:{type:"text",label:"Duplicate size threshold",required:!0,addonRight:{text:"%"}}},{key:"duplicateAgeThreshold",type:"horizontalInput",templateOptions:{type:"number",label:"Duplicate age threshold",required:!0,addonRight:{text:"hours"}}},{key:"removeTrailing",type:"horizontalChips",templateOptions:{type:"text",label:"Remove trailing...",help:"Removed from title if it ends with either of these. Case insensitive and disregards leading/trailing spaces. Apply words with return key."}},{key:"useOriginalCategories",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Use original categories",help:"Enable to use the category descriptions provided by the indexer"}},{key:"nzbAccessType",type:"horizontalSelect",templateOptions:{type:"select",label:"NZB access type",options:[{name:"Proxy NZBs from indexer",value:"PROXY"},{name:"Redirect to the indexer",value:"REDIRECT"}],help:"How access to NZBs is provided when NZBs are downloaded (by the user or external tools). Redirecting is recommended."}},{key:"loadAllCachedOnInternal",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Load all cached results",help:"Show all cached results when searching internally. Might make sorting / filtering slower"}},{wrapper:"fieldset",templateOptions:{label:"Other"},fieldGroup:[{key:"keepSearchResultsForDays",type:"horizontalInput",templateOptions:{type:"number",label:"Store results for ...",addonRight:{text:"days"},required:!0,help:"Meta data from searches is stored in the database. When they're deleted existing links to Hydra become invalid."}},{key:"showQuickFilterButtons",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Show quick filter",help:"Show quick filter buttons for movie and TV results"}}]}]}],categoriesConfig:[{key:"enableCategorySizes",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Category sizes",help:"Preset min and max sizes depending on the selected category"}},{type:"help",templateOptions:{type:"help",lines:["The category configuration is not validated in any way. You can seriously fuck up Hydra's results and overall behavior so take care.","Restrictions will taken from a result's category, not the search request category which may not always be the same."],marginTop:"50px"}},{type:"repeatSection",key:"categories",model:n.categoriesConfig,templateOptions:{btnText:"Add new category",fields:[{key:"name",type:"horizontalInput",templateOptions:{type:"text",label:"Name",help:"Renaming categories might cause problems with repeating searches from the history",required:!0}},{key:"searchType",type:"horizontalSelect",templateOptions:{label:"Search type",options:[{name:"General",value:"SEARCH"},{name:"Audio",value:"MUSIC"},{name:"EBook",value:"BOOK"},{name:"Movie",value:"MOVIE"},{name:"TV",value:"TVSEARCH"}],help:"Determines how indexers will be searched and if autocompletion is available in the GUI"}},{key:"subtype",type:"horizontalSelect",templateOptions:{label:"Sub type",options:[{name:"Anime",value:"ANIME"},{name:"Audiobook",value:"AUDIOBOOK"},{name:"Comic",value:"COMIC"},{name:"Ebook",value:"EBOOK"},{name:"None",value:"NONE"}],help:"Special search type. Used for indexer specific mappings between categories and newznab IDs"}},{key:"applyRestrictionsType",type:"horizontalSelect",templateOptions:{label:"Apply restrictions",options:[{name:"All searches",value:"BOTH"},{name:"Internal searches",value:"INTERNAL"},{name:"API searches",value:"API"},{name:"Never",value:"NONE"}],help:"For which type of search word restrictions will be applied"}},{key:"requiredWords",type:"horizontalChips",templateOptions:{type:"text",label:"Required words",help:"Must *all* be present in a title which is converted to lowercase before. Apply words with return key."}},{key:"requiredRegex",type:"horizontalInput",templateOptions:{type:"text",label:"Required regex",help:"Must be present in a title (case is ignored)"}},{key:"forbiddenWords",type:"horizontalChips",templateOptions:{type:"text",label:"Forbidden words",help:"None may be present in a title which is converted to lowercase before. Apply words with return key."}},{key:"forbiddenRegex",type:"horizontalInput",templateOptions:{type:"text",label:"Forbidden regex",help:"Must not be present in a title (case is ignored)"}},{wrapper:"settingWrapper",templateOptions:{label:"Size preset",help:"Will set these values on the search page"},fieldGroup:[{key:"minSizePreset",type:"duoSetting",templateOptions:{addonRight:{text:"MB"}}},{type:"duolabel"},{key:"maxSizePreset",type:"duoSetting",templateOptions:{addonRight:{text:"MB"}}}]},{key:"applySizeLimitsToApi",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Limit API results size",help:"Enable to apply the size preset to API results from this category"}},{key:"newznabCategories",type:"horizontalChips",templateOptions:{type:"text",label:"Newznab categories",help:"Map newznab categories to Hydra categories. Used for parsing and when searching internally. Apply words with return key."}},{key:"ignoreResultsFrom",type:"horizontalSelect",templateOptions:{label:"Ignore results",options:[{name:"For all searches",value:"BOTH"},{name:"For internal searches",value:"INTERNAL"},{name:"For API searches",value:"API"},{name:"Never",value:"NONE"}],help:"Ignore results from this category"}}],defaultModel:{name:null,applyRestrictionsType:"NONE",forbiddenRegex:null,forbiddenWords:null,ignoreResultsFrom:"NONE",mayBeSelected:!0,maxSizePreset:null,minSizePreset:null,newznabCategories:[],preselect:!0,requiredRegex:null,requiredWords:null,searchType:"SEARCH",subType:"NONE"}}}],downloading:[{wrapper:"fieldset",templateOptions:{label:"General"},fieldGroup:[{key:"saveTorrentsTo",type:"fileInput",templateOptions:{label:"Torrent black hole",help:'When the "Torrent" button is clicked torrents will be saved to this folder on the server. Ignored if not set.',type:"folder"}}]},{wrapper:"fieldset",key:"downloaders",templateOptions:{label:"Downloaders"},fieldGroup:[{type:"arrayConfig",data:{defaultModel:{enabled:!0},entryTemplateUrl:"downloaderEntry.html",presets:function(){return getDownloaderPresets()},checkAddingAllowed:function(){return!0},presetsOnly:!0,addNewText:"Add new downloader",fieldsFunction:getDownloaderBoxFields,allowDeleteFunction:function(){return!0},checkBeforeClose:function(t,n){var a=e.get("DownloaderCheckBeforeCloseService");return a.check(t,n)},resetFunction:function(e){e.options.resetModel(),e.options.resetModel()}}}]}],indexers:[{type:"arrayConfig",data:{defaultModel:{allCapsChecked:!1,apiKey:null,backend:"NEWZNAB",configComplete:!1,categoryMapping:null,downloadLimit:null,enabled:!0,enabledCategories:[],enabledForSearchSource:"BOTH",generalMinSize:null,hitLimit:null,hitLimitResetTime:0,host:null,loadLimitOnRandom:null,name:null,password:null,preselect:!0,score:0,searchModuleType:"NEWZNAB",showOnSearch:!0,supportedSearchIds:void 0,supportedSearchTypes:void 0,timeout:null,username:null,userAgent:null},addNewText:"Add new indexer",entryTemplateUrl:"indexerEntry.html",presets:function(e){return getIndexerPresets(e)},checkAddingAllowed:function(e,t){return!t||"ANIZB"!==t.searchModuleType&&"BINSEARCH"!==t.searchModuleType&&"NZBINDEX"!==t.searchModuleType&&"NZBCLUB"!==t.searchModuleType||!_.any(e,function(e){return e.name===t.name})},fieldsFunction:getIndexerBoxFields,allowDeleteFunction:function(e){return!0},checkBeforeClose:function(t,n){var a=e.get("IndexerCheckBeforeCloseService");return a.check(t,n)},resetFunction:function(e){e.options.resetModel(),e.options.resetModel()}}},{type:"recheckAllCaps"}],auth:[{key:"authType",type:"horizontalSelect",templateOptions:{label:"Auth type",options:[{name:"None",value:"NONE"},{name:"HTTP Basic auth",value:"BASIC"},{name:"Login form",value:"FORM"}]}},{key:"restrictSearch",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Restrict searching",help:"Restrict access to searching"},hideExpression:function(){return"NONE"===n.auth.authType}},{key:"restrictStats",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Restrict stats",help:"Restrict access to stats"},hideExpression:function(){return"NONE"===n.auth.authType}},{key:"restrictAdmin",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Restrict admin",help:"Restrict access to admin functions"},hideExpression:function(){return"NONE"===n.auth.authType}},{key:"restrictDetailsDl",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Restrict NZB details & DL",help:"Restrict NZB details, comments and download links"},hideExpression:function(){return"NONE"===n.auth.authType}},{key:"restrictIndexerSelection",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Restrict indexer selection box",help:"Restrict visibility of indexer selection box in search. Affects only GUI"},hideExpression:function(){return"NONE"===n.auth.authType}},{key:"rememberUsers",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Remember users",help:"Remember users with cookie for 14 days"},hideExpression:function(){return"NONE"===n.auth.authType}},{key:"rememberMeValidityDays",type:"horizontalInput",templateOptions:{type:"number",label:"Cookie expiry",help:"How long users are remembered",addonRight:{text:"days"}}},{type:"repeatSection",key:"users",model:n.auth,hideExpression:function(){return"NONE"===n.auth.authType},templateOptions:{btnText:"Add new user",altLegendText:"Authless",fields:[{key:"username",type:"horizontalInput",templateOptions:{type:"text",label:"Username",required:!0}},{key:"password",type:"passwordSwitch",templateOptions:{type:"password",label:"Password",required:!0}},{key:"maySeeAdmin",type:"horizontalSwitch",templateOptions:{type:"switch",label:"May see admin area"}},{key:"maySeeStats",type:"horizontalSwitch",templateOptions:{type:"switch",label:"May see stats"},hideExpression:"model.maySeeAdmin"},{key:"maySeeDetailsDl",type:"horizontalSwitch",templateOptions:{type:"switch",label:"May see NZB details & DL links"},hideExpression:"model.maySeeAdmin"},{key:"showIndexerSelection",type:"horizontalSwitch",templateOptions:{type:"switch",label:"May see indexer selection box"},hideExpression:"model.maySeeAdmin"}],defaultModel:{username:null,password:null,maySeeStats:!0,maySeeAdmin:!0,maySeeDetailsDl:!0,showIndexerSelection:!0}}}]}}};function t(e,t,n){return{expression:function(t,n){var a=n||t;return!a||e.test(a)},message:(n?'$viewValue + " ':'" ')+t+'"'}}}function getIndexerPresets(e){return[[{name:"6box",host:"https://6box.me"},{name:"6box spotweb",host:"https://6box.me/spotweb"},{name:"altHUB",host:"https://api.althub.co.za"},{name:"dbKitty",host:"https://dbkitty.club"},{name:"DogNZB",host:"https://api.dognzb.cr"},{name:"Drunken Slug",host:"https://api.drunkenslug.com"},{name:"FastNZB",host:"https://fastnzb.com"},{name:"LuluNZB",host:"https://lulunzb.com"},{name:"miatrix",host:"https://www.miatrix.com"},{name:"newz69.keagaming",host:"https://newz69.keagaming.com"},{name:"NewzTown",host:"https://newztown.co.za"},{name:"NZB Finder",host:"https://nzbfinder.ws"},{name:"NZBCat",host:"https://nzb.cat"},{name:"nzb.ag",host:"https://nzb.ag"},{name:"nzb.is",host:"https://nzb.is"},{name:"nzb.su",host:"https://api.nzb.su"},{name:"nzb7",host:"https://www.nzb7.com"},{name:"NZBGeek",host:"https://api.nzbgeek.info"},{name:"NzbNdx",host:"https://www.nzbndx.com"},{name:"NzBNooB",host:"https://www.nzbnoob.com"},{name:"nzbplanet",host:"https://nzbplanet.net"},{name:"NZBs.org",host:"https://nzbs.org"},{name:"NZBs.io",host:"https://www.nzbs.io"},{name:"Nzeeb",host:"https://www.nzeeb.com"},{name:"oznzb",host:"https://api.oznzb.com"},{name:"omgwtfnzbs",host:"https://api.omgwtfnzbs.me"},{name:"PFMonkey",host:"https://www.pfmonkey.com"},{name:"SimplyNZBs",host:"https://simplynzbs.com"},{name:"Tabula-Rasa",host:"https://www.tabula-rasa.pw"},{name:"Usenet-Crawler",host:"https://www.usenet-crawler.com"}],[{allCapsChecked:!0,configComplete:!0,name:"Jackett/Cardigann",host:"http://127.0.0.1:9117/api/v2.0/indexers/YOURTRACKER/results/torznab/",supportedSearchIds:void 0,supportedSearchTypes:void 0,searchModuleType:"TORZNAB",enabledForSearchSource:"BOTH"}],[{allCapsChecked:!0,enabledForSearchSource:"BOTH",categories:["Anime"],configComplete:!0,downloadLimit:null,enabled:!1,hitLimit:null,hitLimitResetTime:null,host:"https://anizb.org",loadLimitOnRandom:null,name:"anizb",password:null,preselect:!0,score:0,supportedSearchIds:[],supportedSearchTypes:[],showOnSearch:!0,timeout:null,searchModuleType:"ANIZB",username:null},{allCapsChecked:!0,enabledForSearchSource:"INTERNAL",categories:[],configComplete:!0,downloadLimit:null,enabled:!0,hitLimit:null,hitLimitResetTime:null,host:"https://binsearch.info",loadLimitOnRandom:null,name:"Binsearch",password:null,preselect:!0,score:0,supportedSearchIds:[],supportedSearchTypes:[],showOnSearch:!0,timeout:null,searchModuleType:"BINSEARCH",username:null},{allCapsChecked:!0,enabledForSearchSource:"INTERNAL",categories:[],configComplete:!0,downloadLimit:null,enabled:!0,generalMinSize:1,hitLimit:null,hitLimitResetTime:null,host:"https://nzbindex.com",loadLimitOnRandom:null,name:"NZBIndex",password:null,preselect:!0,score:0,supportedSearchIds:[],supportedSearchTypes:[],showOnSearch:!0,timeout:null,searchModuleType:"NZBINDEX",username:null}]]}function getIndexerBoxFields(e,t,n,a,r){var o=[];if("TORZNAB"===e.searchModuleType)o.push({type:"help",templateOptions:{type:"help",lines:["Torznab indexers can only be used for internal searches or dedicated searches using /torznab/api"]}});else if(("NEWZNAB"===e.searchModuleType||"TORZNAB"===e.searchModuleType)&&!n){var i,l;e.configComplete?(i="The capabilities of this indexer were not checked completely. Some actually supported search types or IDs may not be usable.",l="alert alert-warning"):(i="The config of this indexer is incomplete. Please click the button at the bottom to check its capabilities and complete its configuration.",l="alert alert-danger"),o.push({type:"help",hideExpression:"model.allCapsChecked && model.configComplete",templateOptions:{type:"help",lines:[i],class:l}})}if(o.push({key:"enabled",type:"horizontalSwitch",hideExpression:"!model.configComplete",templateOptions:{type:"switch",label:"Enabled"}}),"NEWZNAB"!==e.searchModuleType&&"TORZNAB"!==e.searchModuleType||o.push({key:"name",type:"horizontalInput",templateOptions:{type:"text",label:"Name",required:!0,help:"Used for identification. Changing the name will lose all history and stats!"},validators:{uniqueName:{expression:function(a){return!n&&a===e.name||-1===_.pluck(t,"name").indexOf(a)},message:'"Indexer \\"" + $viewValue + "\\" already exists"'},noComma:{expression:function(e,t){var n=t||e;return!n||-1===n.indexOf(",")},message:'"Name may not contain a comma"'}}}),"NEWZNAB"===e.searchModuleType||"TORZNAB"===e.searchModuleType){var s={key:"host",type:"horizontalInput",templateOptions:{type:"text",label:"Host",required:!0,placeholder:"http://www.someindexer.com"},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}};"TORZNAB"===e.searchModuleType&&(s.templateOptions.help="If you use Jackett and have an external URL use that one"),o.push(s)}if("NEWZNAB"!==e.searchModuleType&&"TORZNAB"!==e.searchModuleType||o.push({key:"apiKey",type:"horizontalInput",templateOptions:{type:"text",label:"API Key"},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}}),o.push({key:"score",type:"horizontalInput",templateOptions:{type:"number",label:"Priority",required:!0,help:"When duplicate search results are found the result from the indexer with the highest number will be selected"}}),o.push({key:"timeout",type:"horizontalInput",templateOptions:{type:"number",label:"Timeout",help:'Supercedes the general timeout in "Searching"'}},{key:"schedule",type:"horizontalChips",templateOptions:{type:"text",label:"Schedule",help:'Determines when an indexer should be selected. See <a href="https://github.com/theotherp/nzbhydra2/wiki/Indexer-schedules" target="_blank">wiki</a>. You can enter multiple time spans. Apply values with return key.'}}),"NEWZNAB"!==e.searchModuleType&&"TORZNAB"!==e.searchModuleType||(o.push({key:"hitLimit",type:"horizontalInput",templateOptions:{type:"number",label:"API hit limit",help:'Maximum number of API hits since "API hit reset time"'}},{key:"downloadLimit",type:"horizontalInput",templateOptions:{type:"number",label:"Download limit",help:'When # of downloads since "Hit reset time" is reached indexer will not be searched.'}}),o.push({key:"loadLimitOnRandom",type:"horizontalInput",templateOptions:{type:"number",label:"Load limiting",help:"If set indexer will only be picked for one out of x API searches (on average)"},validators:{greaterThanZero:{expression:function(e,t){var n=t||e;return angular.isUndefined(n)||null===n||""===n||n>1},message:'"Value must be greater than 1"'}}},{key:"hitLimitResetTime",type:"horizontalInput",hideExpression:"!model.hitLimit && !model.downloadLimit",templateOptions:{type:"number",label:"Hit reset time",help:"UTC hour of day at which the API hit counter is reset (0-23). Leave empty for a rolling reset counter"},validators:{timeOfDay:{expression:function(e,t){var n=t||e;return n>=0&&n<=23},message:'$viewValue + " is not a valid hour of day (0-23)"'}}})),"NEWZNAB"===e.searchModuleType&&o.push({key:"username",type:"horizontalInput",templateOptions:{type:"text",required:!1,label:"Username",help:"Only needed if indexer requires HTTP auth for API access (rare)"},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}}),"NEWZNAB"===e.searchModuleType&&o.push({key:"password",type:"passwordSwitch",hideExpression:"!model.username",templateOptions:{type:"text",required:!1,label:"Password",help:"Only needed if indexer requires HTTP auth for API access (rare)"}}),"NEWZNAB"===e.searchModuleType&&o.push({key:"userAgent",type:"horizontalInput",templateOptions:{type:"text",required:!1,label:"User agent",help:"Rarely needed. Will supercede the one in the main searching settings"}}),o.push({key:"preselect",type:"horizontalSwitch",hideExpression:'model.enabledForSearchSource==="EXTERNAL"',templateOptions:{type:"switch",label:"Preselect",help:"Preselect this indexer on the search page"}}),o.push({key:"enabledForSearchSource",type:"horizontalSelect",templateOptions:{label:"Enable for...",options:[{name:"Internal searches only",value:"INTERNAL"},{name:"API searches only",value:"API"},{name:"Internal and API searches",value:"BOTH"}]}}),"ANIZB"!==e.searchModuleType){var c=r.getWithoutAll(),u=_.map(c,function(e){return{id:e.name,label:e.name}});o.push({key:"enabledCategories",type:"horizontalMultiselect",templateOptions:{label:"Categories",help:"Only use indexer when searching for these and also reject results from others. Selecting none equals selecting all",options:u,settings:{showSelectedValues:!1,noSelectedText:"None/All"}}})}return"NEWZNAB"!==e.searchModuleType&&"TORZNAB"!==e.searchModuleType||o.push({key:"supportedSearchIds",type:"horizontalMultiselect",templateOptions:{label:"Search IDs",options:[{label:"TVDB",id:"TVDB"},{label:"TVRage",id:"TVRAGE"},{label:"IMDB",id:"IMDB"},{label:"Trakt",id:"TRAKT"},{label:"TVMaze",id:"TVMAZE"},{label:"TMDB",id:"TMDB"}],noSelectedText:"None"}}),"NEWZNAB"!==e.searchModuleType&&"TORZNAB"!==e.searchModuleType||o.push({key:"supportedSearchTypes",type:"horizontalMultiselect",templateOptions:{label:"Search types",options:[{label:"Movies",id:"MOVIE"},{label:"TV",id:"TVSEARCH"},{label:"Ebooks",id:"BOOK"},{label:"Audio",id:"AUDIO"}],buttonText:"None"}}),"NEWZNAB"!==e.searchModuleType&&"TORZNAB"!==e.searchModuleType||o.push({type:"horizontalCheckCaps",hideExpression:'!model.host || (!model.apiKey && model.host.toLowerCase().indexOf("sickbeard")===-1) || !model.name',templateOptions:{label:"Check capabilities",help:"Find out what search types and IDs the indexer supports. Done automatically for new indexers."}}),"nzbindex"===e.searchModuleType&&o.push({key:"generalMinSize",type:"horizontalInput",templateOptions:{type:"number",label:"Min size",help:"NZBIndex returns a lot of crap with small file sizes. Set this value and all smaller results will be filtered out no matter the category"}}),o}function getDownloaderBoxFields(e,t,n){var a=[];return a=_.union(a,[{key:"enabled",type:"horizontalSwitch",templateOptions:{type:"switch",label:"Enabled"}},{key:"name",type:"horizontalInput",templateOptions:{type:"text",label:"Name",required:!0},validators:{uniqueName:{expression:function(a){return!n&&a===e.name||-1===_.pluck(t,"name").indexOf(a)},message:'"Downloader \\"" + $viewValue + "\\" already exists"'}}},{key:"url",type:"horizontalInput",templateOptions:{type:"text",label:"URL",help:"URL with scheme and full path",required:!0},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}}]),"SABNZBD"===e.downloaderType?a.push({key:"apiKey",type:"horizontalInput",templateOptions:{type:"text",label:"API Key"},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}}):"NZBGET"===e.downloaderType&&(a.push({key:"username",type:"horizontalInput",templateOptions:{type:"text",label:"Username"},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}}),a.push({key:"password",type:"passwordSwitch",templateOptions:{type:"text",label:"Password"},watcher:{listener:function(e,t,n,a){t!==n&&(a.$parent.needsConnectionTest=!0)}}})),a=_.union(a,[{key:"defaultCategory",type:"horizontalInput",templateOptions:{type:"text",label:"Default category",help:'When adding NZBs this category will be used instead of asking for the category. Write "No category" to let the downloader decide.',placeholder:"Ask when downloading"}},{key:"nzbAddingType",type:"horizontalSelect",templateOptions:{type:"select",label:"NZB adding type",options:[{name:"Send link",value:"SEND_LINK"},{name:"Upload NZB",value:"UPLOAD"}],help:"How NZBs are added to the downloader, either by sending a link to the NZB or by uploading the NZB data. Uploading is recommended"}},{key:"iconCssClass",type:"horizontalInput",templateOptions:{type:"text",label:"Icon CSS class",help:'Copy an icon name from http://fontawesome.io/examples/ (e.g. "film")',placeholder:"Default"}}])}function getDownloaderPresets(){return[[{name:"NZBGet",downloaderType:"NZBGET",username:"nzbgetx",nzbAddingType:"UPLOAD",nzbAccessType:"REDIRECT",iconCssClass:"",downloadType:"NZB",url:"http://nzbget:tegbzn6789@localhost:6789"},{url:"http://localhost:8086",downloaderType:"SABNZBD",name:"SABnzbd",nzbAddingType:"UPLOAD",nzbAccessType:"REDIRECT",iconCssClass:"",downloadType:"NZB"}]]}function handleConnectionCheckFail(e,t,n,a,r){var o,i;t.checked?(o="The connection to the "+a+" failed: "+t.message+"<br>Do you want to add it anyway?",i="I know what I'm doing"):(o="The connection to the "+a+" could not be tested, sorry. Please check the log.",i="I'll risk it"),e.open("Connection check failed",o,{yes:{onYes:function(){r.resolve()},text:i},no:{onNo:function(){n.enabled=!1,r.resolve()},text:"Add it, but disabled"},cancel:{onCancel:function(){r.reject()},text:"Aahh, let me try again"}})}function IndexerCheckBeforeCloseService(e,t,n,a,r){return{check:function(i,l){var s=e.defer();if(i.isInitial||i.needsConnectionTest&&!i.form.capsChecked){r.start("Testing connection..."),i.spinnerActive=!0;n.checkConnection("internalapi/indexer/checkConnection",l).then(function(){a.info("Connection to the indexer tested successfully"),o(i,l).then(function(e){r.reset(),i.spinnerActive=!1,s.resolve(e)},function(){r.reset(),i.spinnerActive=!1,s.reject()})},function(e){r.reset(),handleConnectionCheckFail(t,e,l,"indexer",s)})}else o(i,l).then(function(){s.resolve(l)},function(){s.reject()});return s.promise}};function o(o,i){var l=e.defer();return angular.isUndefined(i.supportedSearchIds)||angular.isUndefined(i.supportedSearchTypes)?(r.start("New indexer found. Testing its capabilities. This may take a bit..."),n.checkCaps({indexerConfig:i,checkType:"SINGLE"}).then(function(e){e=e[0],r.reset(),o.spinnerActive=!1,e.allCapsChecked&&e.configComplete?a.info("Successfully tested capabilites of indexer"):!e.allCapsChecked&&e.configComplete?t.open("Incomplete caps check","The capabilities of the indexer could not be checked completely. You may use it but it's recommended to repeat the check at another time.<br>Until then some search types or IDs may not be usable.",{},"md","left"):e.configComplete||t.open("Error testing capabilities","An error occurred while contacting the indexer. It will not be usable until the caps check has been executed. You can trigger it manually from the indexer config box",{},"md","left"),l.resolve(e.indexerConfig)},function(){r.reset(),o.spinnerActive=!1,i.supportedSearchIds=void 0,i.supportedSearchTypes=void 0,t.open("Error testing capabilities","An error occurred while contacting the indexer. It will not be usable until the caps check has been executed. You can trigger it manually using the button below.",{},"md","left"),l.resolve()}).finally(function(){o.spinnerActive=!1})):l.resolve(),l.promise}}function DownloaderCheckBeforeCloseService(e,t,n,a,r){return{check:function(o,i){var l=e.defer();if(o.isInitial||o.needsConnectionTest){o.spinnerActive=!0,r.start("Testing connection...");t.checkConnection("internalapi/downloader/checkConnection",JSON.stringify(i)).then(function(){r.reset(),o.spinnerActive=!1,n.info("Connection to the downloader tested successfully"),l.resolve()},function(e){r.reset(),o.spinnerActive=!1,handleConnectionCheckFail(a,e,i,"downloader",l)}).finally(function(){o.spinnerActive=!1,r.reset()})}else l.resolve();return l.promise}}}function ConfigController(e,t,n,a,r,o,i,l,s,c,u,d,p){function f(){angular.isUndefined(e.form)?console.error("Unable to determine if a restart is necessary"):(e.form.$setPristine(),o.invalidate(),e.restartRequired&&s.open("Restart required","The changes you have made may require a restart to be effective.<br>Do you want to restart now?",{yes:{onYes:function(){c.restart()}},no:{onNo:function(t){e.restartRequired=!1,t.dismiss(),t.dismiss()}}}))}e.config=r,e.submit=function(){if(e.form.$valid)a.set(e.config,!0).then(function(t){!function t(n,r,o){angular.isUndefined(r)&&(r=null!==u.get("ignoreWarnings")&&u.get("ignoreWarnings"));var i=n.data.warningMessages;var l=n.data.errorMessages;e.restartRequired=n.data.restartNeeded||!!angular.isDefined(o)&&o;var c=l.length>0||i.length>0&&!r;function d(e,t){return _.forEach(t,function(t){e+="<li>"+t+"</li>"}),e+="</ul></span>"}if(c){var h,m,g;l.length>0?(g="Config validation failed",m=d(m='<span class="error">The following errors have been found in your config. They need to be fixed.<ul>',n.data.errorMessages),i.length>0&&(m=d(m+='<br><span class="warning">The following warnings were found. You can ignore them if you wish.<ul>',n.data.warningMessages)),h={yes:{onYes:function(){},text:"OK"}}):i.length>0&&(g="Config validation warnings",m=d(m='<br><span class="warning">The following warnings have been found. You can ignore them if you wish. The config was already saved.<ul>',n.data.warningMessages),h={cancel:{onCancel:function(){e.form.$setPristine(),u.set("ignoreWarnings",!0),a.set(e.config,!0).then(function(n){t(n,!0,e.restartRequired),f()},function(e){p.error(e.data)})},text:"OK, don't show warnings again"},yes:{onYes:function(){t(n,!0,e.restartRequired),f()},text:"OK"}}),s.open(g,m,h,"md","left")}else f()}(t)},function(e){p.error(e.data)});else{p.error("Config invalid. Please check your settings.");try{angular.isDefined(form.$error.required)&&_.each(form.$error.required,function(e){angular.isDefined(e.$error.required)&&_.each(e.$error.required,function(e){e.$setTouched()})}),angular.forEach(e.form.$error.required,function(e){e.$setTouched()})}catch(e){}}},e.activeTab=n,e.restartRequired=!1,e.ignoreSaveNeeded=!1,l=r,e.fields=i.getFields(e.config),e.allTabs=[{active:!1,state:"root.config.main",name:"Main",model:l.main,fields:e.fields.main,options:{}},{active:!1,state:"root.config.auth",name:"Authorization",model:l.auth,fields:e.fields.auth,options:{}},{active:!1,state:"root.config.searching",name:"Searching",model:l.searching,fields:e.fields.searching,options:{}},{active:!1,state:"root.config.categories",name:"Categories",model:l.categoriesConfig,fields:e.fields.categoriesConfig,options:{}},{active:!1,state:"root.config.downloading",name:"Downloading",model:l.downloading,fields:e.fields.downloading,options:{}},{active:!1,state:"root.config.indexers",name:"Indexers",model:l.indexers,fields:e.fields.indexers,options:{}}],e.isSavingNeeded=function(){return e.form.$dirty&&e.form.$valid&&!e.ignoreSaveNeeded},e.goToConfigState=function(t){d.go(e.allTabs[t].state,{activeTab:t},{inherit:!1,notify:!0,reload:!0})},e.help=function(){var n=e.allTabs[e.activeTab].name;t.get("internalapi/help/"+n).then(function(e){var t='<span style="text-align: left;">'+e.data+"</span>";s.open(n+" - Help",t,{},"lg")},function(){p.error("Error while loading help")})},e.$on("$stateChangeStart",function(t,n,a,r,o){e.isSavingNeeded()&&(t.preventDefault(),s.open("Unsaved changed","Do you want to save before leaving?",{yes:{onYes:function(){e.submit(),d.go(n)},text:"Yes"},no:{onNo:function(){e.ignoreSaveNeeded=!0,e.allTabs[e.activeTab].options.resetModel(),d.go(n)},text:"No"},cancel:{onCancel:function(){t.preventDefault()},text:"Cancel"}}))})}function CategoriesService(e){return{getByName:function(t){for(var n in e.getSafe().categoriesConfig.categories){var a=e.getSafe().categoriesConfig.categories[n];if(a.name===t)return a}},getAllCategories:t,getDefault:function(){return t()[0]},getWithoutAll:function(){var t=e.getSafe().categoriesConfig.categories;return t.slice(1,t.length)}};function t(){return e.getSafe().categoriesConfig.categories}}function BackupService(e){return{getBackupsList:function(){return e.get("internalapi/backup/list").then(function(e){return e.data})},restoreFromFile:function(t){return e.get("internalapi/backup/restore",{params:{filename:t}}).then(function(e){return e})}}}filters.filter("bytes",function(){return function(e){return filesize(e)}}),filters.filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),FileSelectionService.$inject=["$http","$q","$uibModal"],angular.module("nzbhydraApp").factory("FileSelectionService",FileSelectionService),angular.module("nzbhydraApp").controller("FileSelectionModalController",["$scope","$http","$uibModalInstance","FileSelectionService","data","type",function(e,t,n,a,r,o){e.type=o,e.showType="file"===o?"File":"Folder",e.data=r.data,e.select=function(a,r){"file"===r&&"file"===o?n.close(a.fullPath):"folder"===r&&t.post("internalapi/config/folderlisting",{fullPath:a.fullPath,type:o,goUp:!1}).then(function(t){e.data=t.data})},e.goUp=function(){t.post("internalapi/config/folderlisting",{fullPath:e.data.fullPath,type:o,goUp:!0}).then(function(t){e.data=t.data})},e.submit=function(){n.close(e.data.fullPath)}}]),FileDownloadService.$inject=["$http","growl"],angular.module("nzbhydraApp").factory("FileDownloadService",FileDownloadService),DownloaderCategoriesService.$inject=["$http","$q","$uibModal"],angular.module("nzbhydraApp").factory("DownloaderCategoriesService",DownloaderCategoriesService),angular.module("nzbhydraApp").controller("DownloaderCategorySelectionController",["$scope","$uibModalInstance","DownloaderCategoriesService","categories",function(e,t,n,a){e.categories=a,e.select=function(a){n.select(a),t.close(e)}}]),DownloadHistoryController.$inject=["$scope","StatsService","downloads","ConfigService","$timeout","$sce"],angular.module("nzbhydraApp").controller("DownloadHistoryController",DownloadHistoryController),angular.module("nzbhydraApp").filter("reformatDateEpoch",reformatDateEpoch),DebugService.$inject=["$filter"],angular.module("nzbhydraApp").factory("DebugService",DebugService),ConfigService.$inject=["$http","$q","$cacheFactory","bootstrapped"],angular.module("nzbhydraApp").factory("ConfigService",ConfigService),ConfigFields.$inject=["$injector"],IndexerCheckBeforeCloseService.$inject=["$q","ModalService","ConfigBoxService","growl","blockUI"],DownloaderCheckBeforeCloseService.$inject=["$q","ConfigBoxService","growl","ModalService","blockUI"],angular.module("nzbhydraApp").factory("ConfigFields",ConfigFields),angular.module("nzbhydraApp").factory("IndexerCheckBeforeCloseService",IndexerCheckBeforeCloseService),angular.module("nzbhydraApp").factory("DownloaderCheckBeforeCloseService",DownloaderCheckBeforeCloseService),ConfigController.$inject=["$scope","$http","activeTab","ConfigService","config","DownloaderCategoriesService","ConfigFields","ConfigModel","ModalService","RestartService","localStorageService","$state","growl"],angular.module("nzbhydraApp").factory("ConfigModel",function(){return{}}),angular.module("nzbhydraApp").factory("ConfigWatcher",function(){return{watch:function(e){e.$watchGroup(["config.main.host"],function(){},!0)}}}),angular.module("nzbhydraApp").controller("ConfigController",ConfigController),CategoriesService.$inject=["ConfigService"],angular.module("nzbhydraApp").factory("CategoriesService",CategoriesService),BackupService.$inject=["$http"],angular.module("nzbhydraApp").factory("BackupService",BackupService);var duScrollDefaultEasing=function(e){return e<.5?Math.pow(2*e,2)/2:1-Math.pow(2*(1-e),2)/2},duScroll=angular.module("duScroll",["duScroll.scrollspy","duScroll.smoothScroll","duScroll.scrollContainer","duScroll.spyContext","duScroll.scrollHelpers"]).value("duScrollDuration",350).value("duScrollSpyWait",100).value("duScrollSpyRefreshInterval",0).value("duScrollGreedy",!1).value("duScrollOffset",0).value("duScrollEasing",duScrollDefaultEasing).value("duScrollCancelOnEvents","scroll mousedown mousewheel touchmove keydown").value("duScrollBottomSpy",!1).value("duScrollActiveClass","active");"undefined"!=typeof module&&module&&module.exports&&(module.exports=duScroll),angular.module("duScroll.scrollHelpers",["duScroll.requestAnimation"]).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset","duScrollCancelOnEvents",function(e,t,n,a,r,o,i,l){"use strict";var s,c,u={},d=function(e){return"undefined"!=typeof HTMLDocument&&e instanceof HTMLDocument||e.nodeType&&e.nodeType===e.DOCUMENT_NODE},p=function(e){return"undefined"!=typeof HTMLElement&&e instanceof HTMLElement||e.nodeType&&e.nodeType===e.ELEMENT_NODE},f=function(e){return p(e)||d(e)?e:e[0]};u.duScrollTo=function(t,n,a,r){var o;if(angular.isElement(t)?o=this.duScrollToElement:angular.isDefined(a)&&(o=this.duScrollToAnimated),o)return o.apply(this,arguments);var i=f(this);if(d(i))return e.scrollTo(t,n);i.scrollLeft=t,i.scrollTop=n},u.duScrollToAnimated=function(e,o,i,u){i&&!u&&(u=r);var d=this.duScrollLeft(),p=this.duScrollTop(),f=Math.round(e-d),h=Math.round(o-p),m=null,g=0,y=this,b=function(e){(!e||g&&e.which>0)&&(l&&y.unbind(l,b),n(s),c.reject(),s=null)};if(s&&b(),c=t.defer(),0===i||!f&&!h)return 0===i&&y.duScrollTo(e,o),c.resolve(),c.promise;var v=function(e){null===m&&(m=e);var t=(g=e-m)>=i?1:u(g/i);y.scrollTo(d+Math.ceil(f*t),p+Math.ceil(h*t)),t<1?s=a(v):(l&&y.unbind(l,b),s=null,c.resolve())};return y.duScrollTo(d,p),l&&y.bind(l,b),s=a(v),c.promise},u.duScrollToElement=function(e,t,n,a){var r=f(this);angular.isNumber(t)&&!isNaN(t)||(t=i);var o=this.duScrollTop()+f(e).getBoundingClientRect().top-t;return p(r)&&(o-=r.getBoundingClientRect().top),this.duScrollTo(0,o,n,a)},u.duScrollLeft=function(t,n,a){if(angular.isNumber(t))return this.duScrollTo(t,this.duScrollTop(),n,a);var r=f(this);return d(r)?e.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft:r.scrollLeft},u.duScrollTop=function(t,n,a){if(angular.isNumber(t))return this.duScrollTo(this.duScrollLeft(),t,n,a);var r=f(this);return d(r)?e.scrollY||document.documentElement.scrollTop||document.body.scrollTop:r.scrollTop},u.duScrollToElementAnimated=function(e,t,n,a){return this.duScrollToElement(e,t,n||o,a)},u.duScrollTopAnimated=function(e,t,n){return this.duScrollTop(e,t||o,n)},u.duScrollLeftAnimated=function(e,t,n){return this.duScrollLeft(e,t||o,n)},angular.forEach(u,function(e,t){angular.element.prototype[t]=e;var n=t.replace(/^duScroll/,"scroll");angular.isUndefined(angular.element.prototype[n])&&(angular.element.prototype[n]=e)})}]),angular.module("duScroll.polyfill",[]).factory("polyfill",["$window",function(e){"use strict";var t=["webkit","moz","o","ms"];return function(n,a){if(e[n])return e[n];for(var r,o=n.substr(0,1).toUpperCase()+n.substr(1),i=0;i<t.length;i++)if(e[r=t[i]+o])return e[r];return a}}]),angular.module("duScroll.requestAnimation",["duScroll.polyfill"]).factory("requestAnimation",["polyfill","$timeout",function(e,t){"use strict";var n=0;return e("requestAnimationFrame",function(e,a){var r=(new Date).getTime(),o=Math.max(0,16-(r-n)),i=t(function(){e(r+o)},o);return n=r+o,i})}]).factory("cancelAnimation",["polyfill","$timeout",function(e,t){"use strict";return e("cancelAnimationFrame",function(e){t.cancel(e)})}]),angular.module("duScroll.spyAPI",["duScroll.scrollContainerAPI"]).factory("spyAPI",["$rootScope","$timeout","$interval","$window","$document","scrollContainerAPI","duScrollGreedy","duScrollSpyWait","duScrollSpyRefreshInterval","duScrollBottomSpy","duScrollActiveClass",function(e,t,n,a,r,o,i,l,s,c,u){"use strict";var d={},p=function(n){var o,s,p,h,m=n.$id,g={spies:[]};return g.handler=(o=g,s=!1,p=!1,h=function(){p=!1;var t,n=o.container[0],l=0;if("undefined"!=typeof HTMLElement&&n instanceof HTMLElement||n.nodeType&&n.nodeType===n.ELEMENT_NODE)l=n.getBoundingClientRect().top,t=Math.round(n.scrollTop+n.clientHeight)>=n.scrollHeight;else{var s=r[0].body.scrollHeight||r[0].documentElement.scrollHeight;t=Math.round(a.pageYOffset+a.innerHeight)>=s}var d,f,h,m,g,y,b=c&&t?"bottom":"top";for(m=o.spies,f=o.currentlyActive,h=void 0,d=0;d<m.length;d++)(y=(g=m[d]).getTargetPosition())&&g.$element&&(c&&t||y.top+g.offset-l<20&&(i||-1*y.top+l)<y.height)&&(!h||h[b]<y[b])&&((h={spy:g})[b]=y[b]);h&&(h=h.spy),f===h||i&&!h||(f&&f.$element&&(f.$element.removeClass(u),e.$broadcast("duScrollspy:becameInactive",f.$element,angular.element(f.getTargetElement()))),h&&(h.$element.addClass(u),e.$broadcast("duScrollspy:becameActive",h.$element,angular.element(h.getTargetElement()))),o.currentlyActive=h)},l?function(){s?p=!0:(h(),s=t(function(){s=!1,p&&h()},l,!1))}:h),d[m]=g,n.$on("$destroy",function(){f(n)}),m},f=function(e){var t=e.$id,a=d[t],r=a.container;a.intervalPromise&&n.cancel(a.intervalPromise),r&&r.off("scroll",a.handler),delete d[t]},h=p(e),m=function(e){return d[e.$id]?d[e.$id]:e.$parent?m(e.$parent):d[h]},g=function(e){var t,n,a=e.$scope;if(a)return m(a);for(n in d)if(-1!==(t=d[n]).spies.indexOf(e))return t};return{addSpy:function(e){var t=g(e);t&&(t.spies.push(e),t.container&&function(e){for(;e.parentNode;)if((e=e.parentNode)===document)return!0;return!1}(t.container)||(t.container&&t.container.off("scroll",t.handler),t.container=o.getContainer(e.$scope),s&&!t.intervalPromise&&(t.intervalPromise=n(t.handler,s,0,!1)),t.container.on("scroll",t.handler).triggerHandler("scroll")))},removeSpy:function(t){var n=g(t);t===n.currentlyActive&&(e.$broadcast("duScrollspy:becameInactive",n.currentlyActive.$element),n.currentlyActive=null);var a=n.spies.indexOf(t);-1!==a&&n.spies.splice(a,1),t.$element=null},createContext:p,destroyContext:f,getContextForScope:m}}]),angular.module("duScroll.scrollContainerAPI",[]).factory("scrollContainerAPI",["$document",function(e){"use strict";var t={},n=function(e){return t[e.$id]?e.$id:e.$parent?n(e.$parent):void 0};return{getContainerId:n,getContainer:function(a){var r=n(a);return r?t[r]:e},setContainer:function(e,n){var a=e.$id;return t[a]=n,a},removeContainer:function(e){var a=n(e);a&&delete t[a]}}}]),angular.module("duScroll.smoothScroll",["duScroll.scrollHelpers","duScroll.scrollContainerAPI"]).directive("duSmoothScroll",["duScrollDuration","duScrollOffset","scrollContainerAPI",function(e,t,n){"use strict";return{link:function(a,r,o){r.on("click",function(r){if(o.href&&-1!==o.href.indexOf("#")||""!==o.duSmoothScroll){var i=o.href?o.href.replace(/.*(?=#[^\s]+$)/,"").substring(1):o.duSmoothScroll,l=document.getElementById(i)||document.getElementsByName(i)[0];if(l&&l.getBoundingClientRect){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault();var s=o.offset?parseInt(o.offset,10):t,c=o.duration?parseInt(o.duration,10):e;n.getContainer(a).duScrollToElement(angular.element(l),isNaN(s)?0:s,isNaN(c)?0:c)}}})}}}]),angular.module("duScroll.spyContext",["duScroll.spyAPI"]).directive("duSpyContext",["spyAPI",function(e){"use strict";return{restrict:"A",scope:!0,compile:function(t,n,a){return{pre:function(t,n,a,r){e.createContext(t)}}}}}]),angular.module("duScroll.scrollContainer",["duScroll.scrollContainerAPI"]).directive("duScrollContainer",["scrollContainerAPI",function(e){"use strict";return{restrict:"A",scope:!0,compile:function(t,n,a){return{pre:function(t,n,a,r){a.$observe("duScrollContainer",function(a){angular.isString(a)&&(a=document.getElementById(a)),a=angular.isElement(a)?angular.element(a):n,e.setContainer(t,a),t.$on("$destroy",function(){e.removeContainer(t)})})}}}}}]),angular.module("duScroll.scrollspy",["duScroll.spyAPI"]).directive("duScrollspy",["spyAPI","duScrollOffset","$timeout","$rootScope",function(e,t,n,a){"use strict";var r=function(e,t,n,a){angular.isElement(e)?this.target=e:angular.isString(e)&&(this.targetId=e),this.$scope=t,this.$element=n,this.offset=a};return r.prototype.getTargetElement=function(){return!this.target&&this.targetId&&(this.target=document.getElementById(this.targetId)||document.getElementsByName(this.targetId)[0]),this.target},r.prototype.getTargetPosition=function(){var e=this.getTargetElement();if(e)return e.getBoundingClientRect()},r.prototype.flushTargetCache=function(){this.targetId&&(this.target=void 0)},{link:function(o,i,l){var s,c=l.ngHref||l.href;if(c&&-1!==c.indexOf("#")?s=c.replace(/.*(?=#[^\s]+$)/,"").substring(1):l.duScrollspy?s=l.duScrollspy:l.duSmoothScroll&&(s=l.duSmoothScroll),s){var u=n(function(){var n=new r(s,o,i,-(l.offset?parseInt(l.offset,10):t));e.addSpy(n),o.$on("$locationChangeSuccess",n.flushTargetCache.bind(n));var c=a.$on("$stateChangeSuccess",n.flushTargetCache.bind(n));o.$on("$destroy",function(){e.removeSpy(n),c()})},0,!1);o.$on("$destroy",function(){n.cancel(u)})}}}}]);
//# sourceMappingURL=nzbhydra.js.map
